<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Call Spread</title>
    <script type="text/javascript" src="bower_components/bignumber.js/bignumber.min.js"></script>
    <script type="text/javascript" src="bower_components/web3/dist/web3.js"></script>
    <script>

        function logToScreen(message) {
            var existing = document.getElementById('result').innerHTML;
            document.getElementById('result').innerHTML = existing + "<br/>" + message;
            var objDiv = document.getElementById('result');
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function refresh() {
            document.getElementById("call_spread_address").innerHTML = callSpread.address;
            document.getElementById("buy_leg_address").innerHTML = callSpread._buyerLeg();
            document.getElementById("sell_leg_address").innerHTML = callSpread._sellerLeg();

            document.getElementById("is_active").innerHTML = callSpread._isActive();
            document.getElementById("is_complete").innerHTML = callSpread._isComplete();
            document.getElementById("broker").innerHTML = callSpread._owner();
            document.getElementById("buyer").innerHTML = callSpread._buyer();
            document.getElementById("seller").innerHTML = callSpread._seller();
            document.getElementById("margin").innerHTML = callSpread._marginPct();
            document.getElementById("maturity").innerHTML = callSpread._maxTimeToMaturity() / 60;

            document.getElementById("buy_leg_underlier").innerHTML = web3.toUtf8(buyOption._feedName());
            document.getElementById("buy_leg_strike").innerHTML = buyOption._strikePrice();
            var buyMaturityInSeconds = web3.toDecimal(buyOption._startTime()) + web3.toDecimal(buyOption._timeToMaturity());
            document.getElementById("buy_leg_maturity").innerHTML = new Date(buyMaturityInSeconds * 1000).toLocaleString();
            document.getElementById("buy_leg_notional").innerHTML = buyOption._notional();
            document.getElementById("buy_leg_active").innerHTML = buyOption._isActive();
            document.getElementById("buy_leg_mature").innerHTML = buyOption._isComplete();

            document.getElementById("sell_leg_underlier").innerHTML = web3.toUtf8(sellOption._feedName());
            document.getElementById("sell_leg_strike").innerHTML = sellOption._strikePrice();
            var sellMaturityInSeconds = web3.toDecimal(sellOption._startTime()) + web3.toDecimal(sellOption._timeToMaturity());
            document.getElementById("sell_leg_maturity").innerHTML = new Date(sellMaturityInSeconds * 1000).toLocaleString();
            document.getElementById("sell_leg_notional").innerHTML = sellOption._notional();
            document.getElementById("sell_leg_active").innerHTML = sellOption._isActive();
            document.getElementById("sell_leg_mature").innerHTML = sellOption._isComplete();
        }


        function handleEvent(error, log){
            if(!error) {
                console.log("**********");
                console.log("Received Event: ", log.event);
                console.log(log);
                console.log("The args were: ");
                for (var arg in log.args) {
                    try {console.log(arg, "=>", web3.toUtf8(log.args[arg]));}
                    catch (e) {
                        if(log.args[arg].toString().startsWith("0x"))
                            console.log(arg, "=>", log.args[arg]);
                        else {
                            try {
                                console.log(arg, "=>", web3.toDecimal(log.args[arg]));
                            }
                            catch (e) {
                                console.log(arg, "=>", log.args[arg]);
                            }
                        }
                    }
                }
                console.log("**********\r\n");
            }
        }


        function loadCallSpread(){
            var address = document.getElementById('load_address').value;
            callSpread = callSpreadContract.at(address);
            var buyOptionAddress = callSpread._buyerLeg();
            var sellOptionAddress = callSpread._sellerLeg();
            buyOption = feedBackedCallContract.at(buyOptionAddress);
            sellOption = feedBackedCallContract.at(sellOptionAddress);
            callSpread.allEvents().watch(handleEvent);
            buyOption.allEvents().watch(handleEvent);
            sellOption.allEvents().watch(handleEvent);
            refresh();
        }

        function createBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating buy leg..");
                    buyOption = feedBackedCallContract.new(
                            {
                                from: web3.eth.accounts[0],
                                data: feedBackedCallBinary,
                                gas: 3000000
                            }, function (e, contract) {
                                //if (e != null)
                                //    reject(e);
                                if (typeof contract.address != 'undefined') {
                                    console.log(e, contract);
                                    console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                    document.getElementById('buy_leg_address').textContent = contract.address;
                                    logToScreen("Buy leg created at " + contract.address);
                                    contract.allEvents().watch(handleEvent);
                                    resolve(contract);
                                }
                            });
            });
        }

        function createSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating sell leg..");
                sellOption = feedBackedCallContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: feedBackedCallBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('sell_leg_address').textContent = contract.address;
                                logToScreen("Sell leg created at " + contract.address);
                                contract.allEvents().watch(handleEvent);
                                resolve(contract);
                            }
                        });
            });
        }

        function createCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating call spread..");
                callSpread = callSpreadContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: callSpreadBinary,
                            gas: 4500000
                        }, function (e, contract) {
                            console.log(e, contract);
                            if (typeof contract != 'undefined' && typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('call_spread_address').textContent = contract.address;
                                logToScreen("Call spread created at " + contract.address);
                                contract.allEvents().watch(handleEvent);
                                resolve(contract);
                            }
                        });
            });
        }

        function initializeBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing buy leg..");
                var seller = document.getElementById("buyers_account_address").value; // buyer and seller inverted
                var buyer = document.getElementById("sellers_account_address").value; // for sell option.
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("buy_underlier").value;
                var strike = document.getElementById("buy_strike").value;
                var maturity = document.getElementById("buy_maturity").value;
                var notional = document.getElementById("buy_notional").value;
                buyOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity * 60,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized buy option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing sell leg..");
                var seller = document.getElementById("buyers_account_address").value; // buyer and seller inverted
                var buyer = document.getElementById("sellers_account_address").value; // for sell option.
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("sell_underlier").value;
                var strike = document.getElementById("sell_strike").value;
                var maturity = document.getElementById("sell_maturity").value;
                var notional = document.getElementById("sell_notional").value;
                sellOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity * 60,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized sell option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing call spread..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("buy_underlier").value;
                var buy_strike = document.getElementById("buy_strike").value;
                var sell_strike = document.getElementById("sell_strike").value;
                var maturity = document.getElementById("buy_maturity").value;
                var notional = document.getElementById("buy_notional").value;
                callSpread.initialize.sendTransaction(
                        seller,
                        buyer,
                        sellOption.address,
                        buyOption.address,
                        priceFeedAddress,
                        underlier,
                        sell_strike,
                        buy_strike,
                        notional,
                        maturity * 60,
                        10,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized call spread.");
                            resolve(result);
                        }
                );
            });
        }

        function createContracts() {

            logToScreen("Creating contracts..");

            createBuyOption()
            .then(createSellOption)
            .then(createCallSpread)
            //.then(initializeBuyOption)
            //.then(initializeSellOption)
            .then(initializeCallSpread)
            .then(function(value){logToScreen("Done creating contracts.");refresh()})
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function initializeContracts() {
            initializeBuyOption()
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function validate() {
            logToScreen("Validating..");

            callSpread.validate.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.validate.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent validation transaction: " +  result);
                        refresh();
                    }
            );
        }

        function withdraw() {
            logToScreen("Withdrawing..");

            callSpread.withdraw.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.withdraw.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent withdraw transaction: " +  result);
                        refresh();
                    }
            );
        }

        function exercise() {
            logToScreen("Exercising..");

            callSpread.exercise.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.exercise.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent exercise transaction: " +  result);
                        refresh();
                    }
            );
        }

        var callSpreadBinary = "60606040525b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b6000600060146101000a81548160ff021916908302179055506000600060156101000a81548160ff021916908302179055505b612e3b806100736000396000f360606040523615610123576000357c010000000000000000000000000000000000000000000000000000000090048062e1ffbb1461012557806304cbc7911461014857806325a34aca146101815780632a7ce026146101a457806338283a1f146101dd5780633ccbad50146102005780633ccfd60b14610286578063418d75b6146102a95780634355f1ec146102e25780634e71d92d1461031b5780635c36b1861461032a5780636901f6681461034d5780638ec89e4f14610370578063913bb26314610393578063948ecc99146103b6578063a6f9dae1146103ef578063b2bdfa7b14610407578063caf19e5a14610440578063d32cb0fe146104c4578063dd9bf998146104e7578063ecc7296b14610513578063f86a3c8a1461053657610123565b005b6101326004805050610636565b6040518082815260200191505060405180910390f35b6101556004805050612a77565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61018e600480505061286b565b6040518082815260200191505060405180910390f35b6101b160048050506105bb565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101ea600480505061062d565b6040518082815260200191505060405180910390f35b610270600480803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190505061063f565b6040518082815260200191505060405180910390f35b61029360048050506118dc565b6040518082815260200191505060405180910390f35b6102b66004805050612aa6565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102ef6004805050610595565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6103286004805050612c27565b005b6103376004805050612a63565b6040518082815260200191505060405180910390f35b61035a6004805050611115565b6040518082815260200191505060405180910390f35b61037d600480505061056f565b6040518082815260200191505060405180910390f35b6103a06004805050610582565b6040518082815260200191505060405180910390f35b6103c36004805050610607565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6104056004808035906020019091905050612ba1565b005b6104146004805050612b7b565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6104566004808035906020019091905050612ad5565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156104b65780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6104d16004805050611ea2565b6040518082815260200191505060405180910390f35b6104fd6004808035906020019091905050610d63565b6040518082815260200191505060405180910390f35b6105206004805050612411565b6040518082815260200191505060405180910390f35b61054360048050506105e1565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600060149054906101000a900460ff1681565b600060159054906101000a900460ff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60076000505481565b60086000505481565b600089600660006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634e71d92d604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506000604051808303816000876161da5a03f11561000257505050600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a28c76cc8d8d8b8b8b8a8a604051887c0100000000000000000000000000000000000000000000000000000000028152600401808873ffffffffffffffffffffffffffffffffffffffff1681526020018773ffffffffffffffffffffffffffffffffffffffff1681526020018673ffffffffffffffffffffffffffffffffffffffff1681526020018581526020018481526020018381526020018281526020019750505050505050506020604051808303816000876161da5a03f11561000257505050604051805190602001505088600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634e71d92d604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506000604051808303816000876161da5a03f11561000257505050600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a28c76cc8c8e8b8b8a8a8a604051887c0100000000000000000000000000000000000000000000000000000000028152600401808873ffffffffffffffffffffffffffffffffffffffff1681526020018773ffffffffffffffffffffffffffffffffffffffff1681526020018673ffffffffffffffffffffffffffffffffffffffff1681526020018581526020018481526020018381526020018281526020019750505050505050506020604051808303816000876161da5a03f11561000257505050604051805190602001505081600760005081905550600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600860005081905550600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001506008600050541015610b7d57600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001506008600050819055505b8a600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055508b600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550610d52600360086000505402610d63565b505b9b9a5050505050505050505050565b6000600060006001915060019050610d9c600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16612d6f565b15610f3757600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610eac84612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610f285780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b610f62600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16612d6f565b156110fd57600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661107283612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156110ee5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b8180156111075750805b925061110e565b5050919050565b600060006000600060149054906101000a900460ff16806111425750600060159054906101000a900460ff165b156111e1577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f56616c69646174696f6e20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a1600192506118d7565b6111f2600360086000505402610d63565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015015806113525750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b156113f1577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602f8152602001807f56616c69646174696f6e20726571756972657320617574686f72697a6564207481526020017f726164696e67206163636f756e7473000000000000000000000000000000000081526020015060400191505060405180910390a1600092506118d7565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015091507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b0781600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166114cd84612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156115495780820380516001836020036101000a031916815260200191505b50935050505060405180910390a18115156115f8577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260278152602001807f56616c69646174696f6e2072657175697265732076616c69646174656420627581526020017f796572206c65670000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a1600092506118d7565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015090507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b0781600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166116d483612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156117505780820380516001836020036101000a031916815260200191505b50935050505060405180910390a18015156117ff577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260288152602001807f56616c69646174696f6e2072657175697265732076616c69646174656420736581526020017f6c6c6572206c656700000000000000000000000000000000000000000000000081526020015060400191505060405180910390a1600092506118d7565b6001600060146101000a81548160ff021916908302179055507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b0781306118446001612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156118c05780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1600192506118d7565b505090565b600060006000600060149054906101000a900460ff1615611991577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f5769746864726177616c20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160009250611e9d565b6119bc600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16612d6f565b806119ee57506119ed600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16612d6f565b5b15611a8d577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602b8152602001807f5769746864726177616c206d75737420626520696e697469617465642062792081526020017f7061727469636970616e7400000000000000000000000000000000000000000081526020015060400191505060405180910390a160009250611e9d565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015091507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea9600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611b6984612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611be55780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015090507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea9600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611ccf83612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611d4b5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060156101000a81548160ff021916908302179055507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea930611e0a6001612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611e865780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019250611e9d565b505090565b6000600060006001915060019050611edb600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16612d6f565b1561205257611ee861286b565b50600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611fc784612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156120435780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b61207d600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16612d6f565b156121eb57600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661216083612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156121dc5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150801561230d5750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001505b156123fb576000600060146101000a81548160ff021916908302179055506001600060156101000a81548160ff021916908302179055507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd306123706001612ad5565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156123ec5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b8180156124055750805b925061240c565b505090565b60006000600060006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001509350600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015092508284039150606460076000505483020490503073ffffffffffffffffffffffffffffffffffffffff16318111156126cc577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d582410600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16303073ffffffffffffffffffffffffffffffffffffffff16318403604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d3073ffffffffffffffffffffffffffffffffffffffff16318303604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015050612843565b3073ffffffffffffffffffffffffffffffffffffffff1631811015612842577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d58241030600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16833073ffffffffffffffffffffffffffffffffffffffff163103604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db0823073ffffffffffffffffffffffffffffffffffffffff163103604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150505b5b803073ffffffffffffffffffffffffffffffffffffffff1631149450612864565b5050505090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ae4e7fdf604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015015612a57577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d58241030600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f1156100025750505050604051805190602001509050612a60565b60009050612a60565b90565b6000612a6d612411565b9050612a74565b90565b6000600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050612aa3565b90565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050612ad2565b90565b60206040519081016040528060008152602001508115612b3457604060405190810160405280600781526020017f53554343455353000000000000000000000000000000000000000000000000008152602001509050612b7656612b75565b604060405190810160405280600781526020017f4641494c555245000000000000000000000000000000000000000000000000008152602001509050612b76565b5b919050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415612c235780600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163273ffffffffffffffffffffffffffffffffffffffff16148015612d3b5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015073ffffffffffffffffffffffffffffffffffffffff16145b15612d6c5733600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b5b565b60008173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480612e2f57508173ffffffffffffffffffffffffffffffffffffffff163273ffffffffffffffffffffffffffffffffffffffff16148015612e2e5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b5b9050612e36565b91905056";
        var callSpreadABI = [{"constant":true,"inputs":[],"name":"_maxTimeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"getSellerOption","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"returnMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_marginPct","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"sellerAcct","type":"address"},{"name":"buyerAcct","type":"address"},{"name":"sellerLeg","type":"address"},{"name":"buyerLeg","type":"address"},{"name":"feedProvider","type":"address"},{"name":"feedName","type":"bytes32"},{"name":"sellerStrikePctOfMarketValue","type":"uint256"},{"name":"buyerStrikePctOfMarketValue","type":"uint256"},{"name":"notional","type":"uint256"},{"name":"timeToMaturity","type":"uint256"},{"name":"marginPct","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getBuyerOption","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"claim","outputs":[],"type":"function"},{"constant":false,"inputs":[],"name":"ping","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_sellerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"changeOwner","outputs":[],"type":"function"},{"constant":true,"inputs":[],"name":"_owner","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"flag","type":"bool"}],"name":"toText","outputs":[{"name":"","type":"bytes"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"rebalanceMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"bytes"}],"name":"Error","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Authorization","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Validation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Exercise","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"CashFlow","type":"event"}];
        var feedBackedCallBinary = "60606040525b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b6000600060146101000a81548160ff021916908302179055506000600060156101000a81548160ff021916908302179055505b612072806100736000396000f36060604052361561013a576000357c010000000000000000000000000000000000000000000000000000000090048063060057541461013c5780630b4a26da1461017557806316c9b880146101985780631990da7a146101bb57806320965255146101de5780632a7ce026146102015780633ccfd60b1461023a5780634355f1ec1461025d5780634e71d92d146102965780636901f668146102a55780638ec89e4f146102c8578063913bb263146102eb578063a28c76cc1461030e578063a550f86d14610370578063a6f9dae1146103b2578063ae4e7fdf146103ca578063b2bdfa7b146103ed578063b570571e14610426578063caf19e5a14610449578063d32cb0fe146104cd578063dc76fabc146104f0578063dd9bf99814610513578063ebf312531461053f578063fa1acb5c146105625761013a565b005b6101496004805050611efd565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61018260048050506105f7565b6040518082815260200191505060405180910390f35b6101a56004805050610600565b6040518082815260200191505060405180910390f35b6101c86004805050610609565b6040518082815260200191505060405180910390f35b6101eb6004805050611c41565b6040518082815260200191505060405180910390f35b61020e60048050506105d1565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102476004805050611056565b6040518082815260200191505060405180910390f35b61026a60048050506105ab565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102a36004805050611db5565b005b6102b26004805050610ca3565b6040518082815260200191505060405180910390f35b6102d56004805050610585565b6040518082815260200191505060405180910390f35b6102f86004805050610598565b6040518082815260200191505060405180910390f35b61035a6004808035906020019091908035906020019091908035906020019091908035906020019091908035906020019091908035906020019091908035906020019091905050610624565b6040518082815260200191505060405180910390f35b6103866004808035906020019091905050611f1e565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6103c86004808035906020019091905050611d2f565b005b6103d76004805050611af4565b6040518082815260200191505060405180910390f35b6103fa6004805050611d09565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6104336004805050610612565b6040518082815260200191505060405180910390f35b61045f6004808035906020019091905050611c63565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156104bf5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6104da600480505061134a565b6040518082815260200191505060405180910390f35b6104fd6004805050611b9b565b6040518082815260200191505060405180910390f35b61052960048080359060200190919050506108f1565b6040518082815260200191505060405180910390f35b61054c6004805050611b2b565b6040518082815260200191505060405180910390f35b61056f600480505061061b565b6040518082815260200191505060405180910390f35b600060149054906101000a900460ff1681565b600060159054906101000a900460ff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60056000505481565b60066000505481565b60076000505481565b60096000505481565b600a6000505481565b600086600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555087600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555060008673ffffffffffffffffffffffffffffffffffffffff161415610861576108327f65746865722d63616d702f70726963652d666565640000000000000000000000611f1e565b600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555061088d565b85600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b846005600050819055506064846108a2611b9b565b0204600660005081905550826007600050819055508160096000508190555042600a600050819055506108dc6003600960005054026108f1565b50600190506108e6565b979650505050505050565b600060006000600191506001905061092a600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611fa6565b15610ac557600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610a3a84611c63565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610ab65780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b610af0600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611fa6565b15610c8b57600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610c0083611c63565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610c7c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b818015610c955750805b9250610c9c565b5050919050565b6000600060149054906101000a900460ff1680610ccc5750600060159054906101000a900460ff165b15610d6b577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f56616c69646174696f6e20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160019050611053565b610d7c6003600960005054026108f1565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610edc5750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610f7b577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602f8152602001807f56616c69646174696f6e20726571756972657320617574686f72697a6564207481526020017f726164696e67206163636f756e7473000000000000000000000000000000000081526020015060400191505060405180910390a160009050611053565b6001600060146101000a81548160ff021916908302179055507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b078130610fc06001611c63565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561103c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019050611053565b90565b6000600060149054906101000a900460ff1615611107577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f5769746864726177616c20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160009050611347565b611132600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611fa6565b806111645750611163600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611fa6565b5b15611203577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602b8152602001807f5769746864726177616c206d75737420626520696e697469617465642062792081526020017f7061727469636970616e7400000000000000000000000000000000000000000081526020015060400191505060405180910390a160009050611347565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060156101000a81548160ff021916908302179055507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea9306112b46001611c63565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156113305780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019050611347565b90565b6000611377600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611fa6565b1515611417577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260238152602001807f4578657263697365206d75737420626520696e6974696174656420627920627581526020017f796572000000000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160009050611af1565b61141f611af4565b1515611499577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252601a8152602001807f4578657263697365207265717569726573206d6174757269747900000000000081526020015060200191505060405180910390a160009050611af1565b60003073ffffffffffffffffffffffffffffffffffffffff16311115611566577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d58241030600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f1935050505050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d60076000505460066000505402604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150507fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d582410600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f11561000257505050506040518051906020015050600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d600760005054611834611b9b565b02604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150507fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d582410600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150506000600060146101000a81548160ff021916908302179055506001600060156101000a81548160ff021916908302179055507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd30611a5e6001611c63565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611ada5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019050611af1565b90565b60006000600a600050544203905060096000505481101515611b1d5760019150611b2756611b26565b60009150611b27565b5b5090565b60006000611b37611b9b565b9050600660005054811015611b72577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9150611b9756611b96565b600660005054811115611b8c5760019150611b9756611b95565b60009150611b97565b5b5b5090565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166331d98b3f600560005054604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001509050611c3e565b90565b6000600760005054600660005054611c57611b9b565b03029050611c60565b90565b60206040519081016040528060008152602001508115611cc257604060405190810160405280600781526020017f53554343455353000000000000000000000000000000000000000000000000008152602001509050611d0456611d03565b604060405190810160405280600781526020017f4641494c555245000000000000000000000000000000000000000000000000008152602001509050611d04565b5b919050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611db15780600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163273ffffffffffffffffffffffffffffffffffffffff16148015611ec95750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015073ffffffffffffffffffffffffffffffffffffffff16145b15611efa5733600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b5b565b600073985509582b2c38010bfaa3c8d2be60022d3d00da9050611f1b565b90565b6000611f28611efd565b73ffffffffffffffffffffffffffffffffffffffff1663bb34534c83604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001509050611fa1565b919050565b60008173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16148061206657508173ffffffffffffffffffffffffffffffffffffffff163273ffffffffffffffffffffffffffffffffffffffff161480156120655750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b5b905061206d565b91905056";
        var feedBackedCallABI = [{"constant":false,"inputs":[],"name":"nameRegAddress","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_feedName","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[],"name":"_strikePrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_notional","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"getValue","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"claim","outputs":[],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"sellerAcct","type":"address"},{"name":"buyerAcct","type":"address"},{"name":"feedProvider","type":"address"},{"name":"feedName","type":"bytes32"},{"name":"strikePctOfMarketValue","type":"uint256"},{"name":"notional","type":"uint256"},{"name":"timeToMaturity","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"}],"name":"named","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"changeOwner","outputs":[],"type":"function"},{"constant":false,"inputs":[],"name":"isMature","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_owner","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_timeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"flag","type":"bool"}],"name":"toText","outputs":[{"name":"","type":"bytes"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getSpotPrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getMoneyness","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_startTime","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"bytes"}],"name":"Error","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Authorization","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Validation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Exercise","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"CashFlow","type":"event"}];

        var web3 = require('web3');
        web3.setProvider(new web3.providers.HttpProvider('http://localhost:56000'));
        var callSpreadContract = web3.eth.contract(callSpreadABI);
        var callSpread;
        var feedBackedCallContract = web3.eth.contract(feedBackedCallABI);
        var buyOption;
        var sellOption;

    </script>
</head>
<body>
<h1>Call Spread</h1>

<h2>Manage</h2>

<table cellpadding="5" style="font-size: small">
    <tr>
        <td>
            <div style="font-size: x-small">
                <p>Call spread</p>

                <p id="call_spread_address">0x0000000000000000000000000000000000000000</p>

                <p>Buy leg</p>

                <p id="buy_leg_address">0x0000000000000000000000000000000000000000</p>

                <p>Sell leg</p>

                <p id="sell_leg_address">0x0000000000000000000000000000000000000000</p>
            </div>
        </td>
        <td>
            <table>
                <tr>
                    <th></th>
                    <th>Buy leg</th>
                    <th>Sell leg</th>
                </tr>
                <tr>
                    <td>Underlier</td>
                    <td id="buy_leg_underlier"></td>
                    <td id="sell_leg_underlier"></td>
                </tr>
                <tr>
                    <td>Strike</td>
                    <td id="buy_leg_strike"></td></td>
                    <td id="sell_leg_strike"></td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="buy_leg_maturity"></td>
                    <td id="sell_leg_maturity"></td>
                </tr>
                <tr>
                    <td>Notional</td>
                    <td id="buy_leg_notional"></td>
                    <td id="sell_leg_notional"></td>
                </tr>
                <tr>
                    <td>Validated?</td>
                    <td id="buy_leg_active"></td>
                    <td id="sell_leg_active"></td>
                </tr>
                <tr>
                    <td>Mature?</td>
                    <td id="buy_leg_mature"></td>
                    <td id="sell_leg_mature"></td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <tr>
                    <td>Is Active?</td>
                    <td id="is_active">N/A</td>
                </tr>
                <tr>
                    <td>Is Complete?</td>
                    <td id="is_complete">N/A</td>
                </tr>
                <tr>
                    <td>Broker</td>
                    <td id="broker">N/A</td>
                </tr>
                <tr>
                    <td>Buyer</td>
                    <td id="buyer">N/A</td>
                </tr>
                <tr>
                    <td>Seller</td>
                    <td id="seller">N/A</td>
                </tr>
                <tr>
                    <td>Margin (%)</td>
                    <td id="margin">N/A</td>
                </tr>
                <tr>
                    <td>Maturity (m)</td>
                    <td id="maturity">N/A</td>
                </tr>
            </table>
        </td>
    </tr>
</table>


<p/>


<p></p>

<button onclick="withdraw()">Withdraw</button>
<button onclick="validate()">Validate</button>
<button onclick="exercise()">Exercise</button>
<button onclick="refresh()">Refresh</button>

<h2>Load</h2>

<div style="background-color: azure; max-height: 10em; line-height: 1em;overflow: auto;float: right; width: 40%" id="result"></div>

<input type="text" id="load_address" size="40" value="0x9911c1ec8ac3713de638a683184899b32cbca2e7"/>
<button onclick="loadCallSpread()">Load from address</button>

<h2>Create</h2>

<table>
    <tr>
        <td>Buyer</td>
        <td><input type="text" id="buyers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Seller</td>
        <td><input type="text" id="sellers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Price Feed</td>
        <td><input type="text" id="price_feed_address" size="40" value="" /></td>
    </tr>
</table>

<p></p>
<table>
    <tr>
        <th></th>
        <th>Buy leg</th>
        <th>Sell leg</th>
    </tr>
    <tr>
        <td>Underlier</td>
        <td>
            <select id="buy_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
        <td>
            <select id="sell_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>Strike*</td>
        <td><input type="text" id="buy_strike" size="6" value="100" /></td>
        <td><input type="text" id="sell_strike" size="6" value="120" /></td>
    </tr>
    <tr>
        <td>Maturity (m)</td>
        <td><input type="text" id="buy_maturity" size="6" value="20" /></td>
        <td><input type="text" id="sell_maturity" size="6" value="20" /></td>
    </tr>
    <tr>
        <td>Notional (ETH)</td>
        <td><input type="text" id="buy_notional" size="6" value="1" /></td>
        <td><input type="text" id="sell_notional" size="6" value="1" /></td>
    </tr>
</table>

<button onclick="createContracts()">Create</button>

<p>*As percent of current spot.</p>

</body>
</html>