<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Call Spread</title>
    <script type="text/javascript" src="bower_components/bignumber.js/bignumber.min.js"></script>
    <script type="text/javascript" src="bower_components/web3/dist/web3.js"></script>
    <script>

        function logToScreen(message) {
            var existing = document.getElementById('result').innerHTML;
            document.getElementById('result').innerHTML = existing + "<br/>" + message;
            var objDiv = document.getElementById('result');
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function refresh() {
            document.getElementById("call_spread_address").innerHTML = callSpread.address;
            document.getElementById("buy_leg_address").innerHTML = callSpread._buyerLeg();
            document.getElementById("sell_leg_address").innerHTML = callSpread._sellerLeg();

            document.getElementById("is_active").innerHTML = callSpread._isActive();
            document.getElementById("is_complete").innerHTML = callSpread._isComplete();
            document.getElementById("broker").innerHTML = callSpread._broker();
            document.getElementById("buyer").innerHTML = callSpread._buyer();
            document.getElementById("seller").innerHTML = callSpread._seller();
            document.getElementById("margin").innerHTML = callSpread._marginPct();
            document.getElementById("maturity").innerHTML = callSpread._maxTimeToMaturity();

            document.getElementById("buy_leg_underlier").innerHTML = web3.toUtf8(buyOption._feedName());
            document.getElementById("buy_leg_strike").innerHTML = buyOption._strikePrice();
            console.log(web3.toBigNumber(buyOption._strikePrice()));
            document.getElementById("buy_leg_maturity").innerHTML = new Date((buyOption._startTime() + buyOption._timeToMaturity())*10).toLocaleString();
            document.getElementById("buy_leg_notional").innerHTML = buyOption._notional();
            document.getElementById("buy_leg_active").innerHTML = buyOption._isActive();
            document.getElementById("buy_leg_mature").innerHTML = buyOption._isComplete();

            document.getElementById("sell_leg_underlier").innerHTML = web3.toUtf8(sellOption._feedName());
            document.getElementById("sell_leg_strike").innerHTML = sellOption._strikePrice();
            document.getElementById("sell_leg_maturity").innerHTML = new Date((sellOption._startTime() + sellOption._timeToMaturity())*10).toLocaleString();
            document.getElementById("sell_leg_notional").innerHTML = sellOption._notional();
            document.getElementById("sell_leg_active").innerHTML = sellOption._isActive();
            document.getElementById("sell_leg_mature").innerHTML = sellOption._isComplete();
        }


        function loadCallSpread(){
            var address = document.getElementById('load_address').value;
            callSpread = callSpreadContract.at(address);
            var buyOptionAddress = callSpread._buyerLeg();
            var sellOptionAddress = callSpread._sellerLeg();
            buyOption = feedBackedCallContract.at(buyOptionAddress);
            sellOption = feedBackedCallContract.at(sellOptionAddress);
            refresh();
        }

        function createBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating buy leg..");
                    buyOption = feedBackedCallContract.new(
                            {
                                from: web3.eth.accounts[0],
                                data: feedBackedCallBinary,
                                gas: 3000000
                            }, function (e, contract) {
                                //if (e != null)
                                //    reject(e);
                                if (typeof contract.address != 'undefined') {
                                    console.log(e, contract);
                                    console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                    document.getElementById('buy_leg_address').textContent = contract.address;
                                    logToScreen("Buy leg created at " + contract.address);
                                    contract.allEvents().watch(function(error, log){
                                        if(!error) {
                                            console.log("Received Event: ", log.event);
                                            console.log(log);
                                            console.log("The args were: ");
                                            for (var arg in log.args) {
                                                try {console.log(arg, "=>", web3.toUtf8(log.args[arg]));}
                                                catch(err) {console.log(arg, "=>", log.args[arg]);}
                                            }
                                        }
                                    });
                                    resolve(contract);
                                }
                            });
            });
        }

        function createSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating sell leg..");
                sellOption = feedBackedCallContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: feedBackedCallBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('sell_leg_address').textContent = contract.address;
                                logToScreen("Sell leg created at " + contract.address);
                                contract.allEvents().watch(function(error, log){
                                    if(!error) {
                                        console.log("Received Event: ", log.event);
                                        console.log(log);
                                        console.log("The args were: ");
                                        for (var arg in log.args) {
                                            try {console.log(arg, "=>", web3.toUtf8(log.args[arg]));}
                                            catch(err) {console.log(arg, "=>", log.args[arg]);}
                                        }
                                    }
                                });
                                resolve(contract);
                            }
                        });
            });
        }

        function createCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating call spread..");
                callSpread = callSpreadContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: callSpreadBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('call_spread_address').textContent = contract.address;
                                logToScreen("Call spread created at " + contract.address);
                                contract.allEvents().watch(function(error, log){
                                    if(!error) {
                                        console.log("Received Event: ", log.event);
                                        console.log(log);
                                        console.log("The args were: ");
                                        for (var arg in log.args) {
                                            try {console.log(arg, "=>", web3.toUtf8(log.args[arg]));}
                                            catch(err) {console.log(arg, "=>", log.args[arg]);}
                                        }
                                    }
                                });
                                resolve(contract);
                            }
                        });
            });
        }

        function initializeBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing buy leg..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("buy_underlier").value;
                var strike = document.getElementById("buy_strike").value;
                var maturity = document.getElementById("buy_maturity").value;
                var notional = document.getElementById("buy_notional").value;
                buyOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized buy option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing sell leg..");
                var seller = document.getElementById("buyers_account_address").value; // buyer and seller inverted
                var buyer = document.getElementById("sellers_account_address").value; // for sell option.
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("sell_underlier").value;
                var strike = document.getElementById("sell_strike").value;
                var maturity = document.getElementById("sell_maturity").value;
                var notional = document.getElementById("sell_notional").value;
                sellOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized sell option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing call spread..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var buyLegAddress = document.getElementById("buy_leg_address").textContent;
                var sellLegAddress = document.getElementById("sell_leg_address").textContent;
                callSpread.initialize.sendTransaction(
                        seller,
                        buyer,
                        sellLegAddress,
                        buyLegAddress,
                        10,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized call spread.");
                            resolve(result);
                        }
                );
            });
        }

        function createContracts() {

            logToScreen("Creating contracts..");

            createBuyOption()
            .then(createSellOption)
            .then(createCallSpread)
            .then(initializeBuyOption)
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .then(function(value){logToScreen("Done creating contracts.")})
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function initializeContracts() {
            initializeBuyOption()
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function validate() {
            logToScreen("Validating..");

            callSpread.validate.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.validate.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent validation transaction: " +  result);
                        refresh();
                    }
            );
        }

        function withdraw() {
            logToScreen("Withdrawing..");

            callSpread.withdraw.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.withdraw.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent withdraw transaction: " +  result);
                        refresh();
                    }
            );
        }

        function exercise() {
            logToScreen("Exercising..");

            callSpread.exercise.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.exercise.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent exercise transaction: " +  result);
                        refresh();
                    }
            );
        }

        var callSpreadBinary = "60606040525b33600060026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506000600060006101000a81548160ff021916908302179055506000600060016101000a81548160ff021916908302179055505b6120df806100716000396000f3606060405236156100f7576000357c010000000000000000000000000000000000000000000000000000000090048062e1ffbb146100f957806325a34aca1461011c5780632a7ce0261461013f57806338283a1f146101785780633ccfd60b1461019b5780634355f1ec146101be5780635c36b186146101f75780636901f6681461021a5780638ec89e4f1461023d578063913bb26314610260578063948ecc9914610283578063caf19e5a146102bc578063d32cb0fe146102e8578063d617d00a1461030b578063dd9bf99814610344578063ecc7296b14610370578063f7013ef614610393578063f86a3c8a146103e3576100f7565b005b6101066004805050610509565b6040518082815260200191505060405180910390f35b6101296004805050611e68565b6040518082815260200191505060405180910390f35b61014c600480505061048e565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101856004805050610500565b6040518082815260200191505060405180910390f35b6101a860048050506110f2565b6040518082815260200191505060405180910390f35b6101cb6004805050610468565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102046004805050612069565b6040518082815260200191505060405180910390f35b6102276004805050610c6e565b6040518082815260200191505060405180910390f35b61024a600480505061041c565b6040518082815260200191505060405180910390f35b61026d600480505061042f565b6040518082815260200191505060405180910390f35b61029060048050506104da565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102d2600480803590602001909190505061207d565b6040518082815260200191505060405180910390f35b6102f56004805050611540565b6040518082815260200191505060405180910390f35b6103186004805050610442565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61035a600480803590602001909190505061091a565b6040518082815260200191505060405180910390f35b61037d60048050506119fc565b6040518082815260200191505060405180910390f35b6103cd6004808035906020019091908035906020019091908035906020019091908035906020019091908035906020019091905050610512565b6040518082815260200191505060405180910390f35b6103f060048050506104b4565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600060009054906101000a900460ff1681565b600060019054906101000a900460ff1681565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60076000505481565b60086000505481565b600082600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555083600660006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555081600760005081905550600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600860005081905550600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600860005054101561073a57600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001506008600050819055505b84600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555085600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555061090f60036008600050540261091a565b505b95945050505050565b6000600060006001915060019050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610abf57600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507f308b5d9a6c24dd3584afe991f16a54dc24c9aa074f379c1b8cd9aa44f3385b69600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102610aa28461207d565b604051808381526020018281526020019250505060405180910390a15b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610c5657600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507f308b5d9a6c24dd3584afe991f16a54dc24c9aa074f379c1b8cd9aa44f3385b69600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102610c398361207d565b604051808381526020018281526020019250505060405180910390a15b818015610c605750805b9250610c67565b5050919050565b600060006000600060009054906101000a900460ff1680610c9b5750600060019054906101000a900460ff165b15610ca957600192506110ed565b610cba60036008600050540261091a565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610e1a5750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610e2857600092506110ed565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015091507ff36060887b03634eafcf9734f1b2acad3fe23af437d4917ce5bd3704831e17ab600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102610f1d8461207d565b604051808381526020018281526020019250505060405180910390a1811515610f4957600092506110ed565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015090507ff36060887b03634eafcf9734f1b2acad3fe23af437d4917ce5bd3704831e17ab600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660010261103e8361207d565b604051808381526020018281526020019250505060405180910390a180151561106a57600092506110ed565b6001600060006101000a81548160ff021916908302179055507ff36060887b03634eafcf9734f1b2acad3fe23af437d4917ce5bd3704831e17ab3073ffffffffffffffffffffffffffffffffffffffff166001026110c8600161207d565b604051808381526020018281526020019250505060405180910390a1600192506110ed565b505090565b600060006000600060009054906101000a900460ff1615611116576000925061153b565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141580156111c25750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b801561121c5750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b1561122a576000925061153b565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015091507f7a14d806d5b03637e24f48e5c8d1470c2b85c6f229dcb44315ac5af79812eaed600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660010261131f8461207d565b604051808381526020018281526020019250505060405180910390a1600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015090507f7a14d806d5b03637e24f48e5c8d1470c2b85c6f229dcb44315ac5af79812eaed600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001026114308361207d565b604051808381526020018281526020019250505060405180910390a1600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060016101000a81548160ff021916908302179055507f7a14d806d5b03637e24f48e5c8d1470c2b85c6f229dcb44315ac5af79812eaed3073ffffffffffffffffffffffffffffffffffffffff16600102611516600161207d565b604051808381526020018281526020019250505060405180910390a16001925061153b565b505090565b6000600060006001915060019050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156116c1576115ac611e68565b50600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507fc2eb715868dc43c608a0e38dfe087570600e3b1ef451176adcf34aa963d7cb04600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001026116a48461207d565b604051808381526020018281526020019250505060405180910390a15b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561182b57600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507fc2eb715868dc43c608a0e38dfe087570600e3b1ef451176adcf34aa963d7cb04600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660010261180e8361207d565b604051808381526020018281526020019250505060405180910390a15b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150801561194d5750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001505b156119e6576000600060006101000a81548160ff021916908302179055506001600060016101000a81548160ff021916908302179055507fc2eb715868dc43c608a0e38dfe087570600e3b1ef451176adcf34aa963d7cb043073ffffffffffffffffffffffffffffffffffffffff166001026119c9600161207d565b604051808381526020018281526020019250505060405180910390a15b8180156119f05750805b92506119f7565b505090565b60006000600060006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001509350600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015092508284039150606460076000505483020490503073ffffffffffffffffffffffffffffffffffffffff1631811115611cc0577ffd9f113e2f43467092afb600e22a409b7725ed451835d209fc2b577968f12b28600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001023073ffffffffffffffffffffffffffffffffffffffff166001023073ffffffffffffffffffffffffffffffffffffffff1631840360010260405180848152602001838152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d3073ffffffffffffffffffffffffffffffffffffffff16318303604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015050611e40565b3073ffffffffffffffffffffffffffffffffffffffff1631811015611e3f577ffd9f113e2f43467092afb600e22a409b7725ed451835d209fc2b577968f12b283073ffffffffffffffffffffffffffffffffffffffff16600102600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102833073ffffffffffffffffffffffffffffffffffffffff16310360010260405180848152602001838152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db0823073ffffffffffffffffffffffffffffffffffffffff163103604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150505b5b803073ffffffffffffffffffffffffffffffffffffffff1631149450611e61565b5050505090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ae4e7fdf604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001501561205d577ffd9f113e2f43467092afb600e22a409b7725ed451835d209fc2b577968f12b283073ffffffffffffffffffffffffffffffffffffffff16600102600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001023073ffffffffffffffffffffffffffffffffffffffff163160010260405180848152602001838152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f1156100025750505050604051805190602001509050612066565b60009050612066565b90565b60006120736119fc565b905061207a565b90565b600081156120b1577f737563636565646564000000000000000000000000000000000000000000000090506120da566120d9565b7f6661696c6564000000000000000000000000000000000000000000000000000090506120da565b5b91905056";
        var callSpreadABI = [{"constant":true,"inputs":[],"name":"_maxTimeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"returnMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_marginPct","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"ping","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_sellerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"flag","type":"bool"}],"name":"toText","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_broker","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"rebalanceMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"sellerAcct","type":"address"},{"name":"buyerAcct","type":"address"},{"name":"sellerLeg","type":"address"},{"name":"buyerLeg","type":"address"},{"name":"marginPct","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"bytes32"}],"name":"GenericLogEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Authorization","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Validation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Exercise","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"bytes32"},{"indexed":false,"name":"to","type":"bytes32"},{"indexed":false,"name":"amount","type":"bytes32"}],"name":"CashFlow","type":"event"}];
        var feedBackedCallBinary = "60606040525b33600060026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506000600060006101000a81548160ff021916908302179055506000600060016101000a81548160ff021916908302179055505b61194f806100716000396000f360606040523615610124576000357c01000000000000000000000000000000000000000000000000000000009004806306005754146101265780630b4a26da1461015f57806316c9b880146101825780631990da7a146101a557806320965255146101c85780632a7ce026146101eb5780633ccfd60b146102245780634355f1ec146102475780636901f668146102805780638ec89e4f146102a3578063913bb263146102c6578063a28c76cc146102e9578063a550f86d1461034b578063ae4e7fdf1461038d578063b570571e146103b0578063caf19e5a146103d3578063d32cb0fe146103ff578063d617d00a14610422578063dc76fabc1461045b578063dd9bf9981461047e578063ebf31253146104aa578063fa1acb5c146104cd57610124565b005b61013360048050506118a6565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61016c6004805050610588565b6040518082815260200191505060405180910390f35b61018f6004805050610591565b6040518082815260200191505060405180910390f35b6101b2600480505061059a565b6040518082815260200191505060405180910390f35b6101d56004805050611822565b6040518082815260200191505060405180910390f35b6101f86004805050610562565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102316004805050610e12565b6040518082815260200191505060405180910390f35b610254600480505061053c565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61028d6004805050610bd6565b6040518082815260200191505060405180910390f35b6102b060048050506104f0565b6040518082815260200191505060405180910390f35b6102d36004805050610503565b6040518082815260200191505060405180910390f35b61033560048080359060200190919080359060200190919080359060200190919080359060200190919080359060200190919080359060200190919080359060200190919050506105b5565b6040518082815260200191505060405180910390f35b61036160048080359060200190919050506118c7565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61039a60048050506116d2565b6040518082815260200191505060405180910390f35b6103bd60048050506105a3565b6040518082815260200191505060405180910390f35b6103e96004808035906020019091905050611844565b6040518082815260200191505060405180910390f35b61040c6004805050611038565b6040518082815260200191505060405180910390f35b61042f6004805050610516565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b610468600480505061177c565b6040518082815260200191505060405180910390f35b6104946004808035906020019091905050610882565b6040518082815260200191505060405180910390f35b6104b7600480505061170c565b6040518082815260200191505060405180910390f35b6104da60048050506105ac565b6040518082815260200191505060405180910390f35b600060009054906101000a900460ff1681565b600060019054906101000a900460ff1681565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60056000505481565b60066000505481565b60076000505481565b60096000505481565b600a6000505481565b600086600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555087600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555061078c600360096000505402610882565b5060008673ffffffffffffffffffffffffffffffffffffffff161415610804576107d57f65746865722d63616d702f70726963652d6665656400000000000000000000006118c7565b600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550610830565b85600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b8460056000508190555060648461084561177c565b0204600660005081905550826007600050819055508160096000508190555042600a6000508190555060019050610877565b979650505050505050565b6000600060006001915060019050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610a2757600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507f308b5d9a6c24dd3584afe991f16a54dc24c9aa074f379c1b8cd9aa44f3385b69600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102610a0a84611844565b604051808381526020018281526020019250505060405180910390a15b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610bbe57600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507f308b5d9a6c24dd3584afe991f16a54dc24c9aa074f379c1b8cd9aa44f3385b69600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102610ba183611844565b604051808381526020018281526020019250505060405180910390a15b818015610bc85750805b9250610bcf565b5050919050565b6000600060009054906101000a900460ff1680610bff5750600060019054906101000a900460ff165b15610c0d5760019050610e0f565b610c1e600360096000505402610882565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610d7e5750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610d8c5760009050610e0f565b6001600060006101000a81548160ff021916908302179055507ff36060887b03634eafcf9734f1b2acad3fe23af437d4917ce5bd3704831e17ab3073ffffffffffffffffffffffffffffffffffffffff16600102610dea6001611844565b604051808381526020018281526020019250505060405180910390a160019050610e0f565b90565b6000600060009054906101000a900460ff1615610e325760009050611035565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614158015610ede5750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b8015610f385750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b15610f465760009050611035565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060016101000a81548160ff021916908302179055507f7a14d806d5b03637e24f48e5c8d1470c2b85c6f229dcb44315ac5af79812eaed3073ffffffffffffffffffffffffffffffffffffffff166001026110106001611844565b604051808381526020018281526020019250505060405180910390a160019050611035565b90565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561109a57600090506116cf565b6110a26116d2565b15156110b157600090506116cf565b60003073ffffffffffffffffffffffffffffffffffffffff16311115611187577ffd9f113e2f43467092afb600e22a409b7725ed451835d209fc2b577968f12b283073ffffffffffffffffffffffffffffffffffffffff16600102600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001023073ffffffffffffffffffffffffffffffffffffffff163160010260405180848152602001838152602001828152602001935050505060405180910390a15b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f1935050505050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d60076000505460066000505402604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150507ffd9f113e2f43467092afb600e22a409b7725ed451835d209fc2b577968f12b28600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001023073ffffffffffffffffffffffffffffffffffffffff163160010260405180848152602001838152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f11561000257505050506040518051906020015050600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d60076000505461145e61177c565b02604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150507ffd9f113e2f43467092afb600e22a409b7725ed451835d209fc2b577968f12b28600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600102600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166001023073ffffffffffffffffffffffffffffffffffffffff163160010260405180848152602001838152602001828152602001935050505060405180910390a1600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150506000600060006101000a81548160ff021916908302179055506001600060016101000a81548160ff021916908302179055507fc2eb715868dc43c608a0e38dfe087570600e3b1ef451176adcf34aa963d7cb043073ffffffffffffffffffffffffffffffffffffffff166001026116aa6001611844565b604051808381526020018281526020019250505060405180910390a1600190506116cf565b90565b60006000603c600a600050544203049050600960005054811015156116fe576001915061170856611707565b60009150611708565b5b5090565b6000600061171861177c565b9050600660005054811015611753577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff915061177856611777565b60066000505481111561176d576001915061177856611776565b60009150611778565b5b5b5090565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166331d98b3f600560005054604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150905061181f565b90565b600060076000505460066000505461183861177c565b03029050611841565b90565b60008115611878577f737563636565646564000000000000000000000000000000000000000000000090506118a1566118a0565b7f6661696c6564000000000000000000000000000000000000000000000000000090506118a1565b5b919050565b600073985509582b2c38010bfaa3c8d2be60022d3d00da90506118c4565b90565b60006118d16118a6565b73ffffffffffffffffffffffffffffffffffffffff1663bb34534c83604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150905061194a565b91905056";
        var feedBackedCallABI = [{"constant":false,"inputs":[],"name":"nameRegAddress","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_feedName","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[],"name":"_strikePrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_notional","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"getValue","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"sellerAcct","type":"address"},{"name":"buyerAcct","type":"address"},{"name":"feedProvider","type":"address"},{"name":"feedName","type":"bytes32"},{"name":"strikeToMarketRatioPct","type":"uint256"},{"name":"notional","type":"uint256"},{"name":"timeToMaturity","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"}],"name":"named","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"isMature","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_timeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"flag","type":"bool"}],"name":"toText","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_broker","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"getSpotPrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getMoneyness","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_startTime","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"bytes32"}],"name":"GenericLogEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Authorization","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Validation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"bytes32"},{"indexed":false,"name":"success","type":"bytes32"}],"name":"Exercise","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"bytes32"},{"indexed":false,"name":"to","type":"bytes32"},{"indexed":false,"name":"amount","type":"bytes32"}],"name":"CashFlow","type":"event"}];

        var web3 = require('web3');
        web3.setProvider(new web3.providers.HttpProvider('http://localhost:56000'));
        var callSpreadContract = web3.eth.contract(callSpreadABI);
        var callSpread;
        var feedBackedCallContract = web3.eth.contract(feedBackedCallABI);
        var buyOption;
        var sellOption;

    </script>
</head>
<body>
<h1>Call Spread</h1>

<h2>Manage</h2>

<table cellpadding="5" style="font-size: small">
    <tr>
        <td>
            <div style="font-size: x-small">
                <p>Call spread</p>

                <p id="call_spread_address">0x0000000000000000000000000000000000000000</p>

                <p>Buy leg</p>

                <p id="buy_leg_address">0x0000000000000000000000000000000000000000</p>

                <p>Sell leg</p>

                <p id="sell_leg_address">0x0000000000000000000000000000000000000000</p>
            </div>
        </td>
        <td>
            <table>
                <tr>
                    <th></th>
                    <th>Buy leg</th>
                    <th>Sell leg</th>
                </tr>
                <tr>
                    <td>Underlier</td>
                    <td id="buy_leg_underlier"></td>
                    <td id="sell_leg_underlier"></td>
                </tr>
                <tr>
                    <td>Strike</td>
                    <td id="buy_leg_strike"></td></td>
                    <td id="sell_leg_strike"></td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="buy_leg_maturity"></td>
                    <td id="sell_leg_maturity"></td>
                </tr>
                <tr>
                    <td>Notional</td>
                    <td id="buy_leg_notional"></td>
                    <td id="sell_leg_notional"></td>
                </tr>
                <tr>
                    <td>Validated?</td>
                    <td id="buy_leg_active"></td>
                    <td id="sell_leg_active"></td>
                </tr>
                <tr>
                    <td>Mature?</td>
                    <td id="buy_leg_mature"></td>
                    <td id="sell_leg_mature"></td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <tr>
                    <td>Is Active?</td>
                    <td id="is_active">N/A</td>
                </tr>
                <tr>
                    <td>Is Complete?</td>
                    <td id="is_complete">N/A</td>
                </tr>
                <tr>
                    <td>Broker</td>
                    <td id="broker">N/A</td>
                </tr>
                <tr>
                    <td>Buyer</td>
                    <td id="buyer">N/A</td>
                </tr>
                <tr>
                    <td>Seller</td>
                    <td id="seller">N/A</td>
                </tr>
                <tr>
                    <td>Margin (%)</td>
                    <td id="margin">N/A</td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="maturity">N/A</td>
                </tr>
            </table>
        </td>
    </tr>
</table>


<p/>


<p></p>

<button onclick="withdraw()">Withdraw</button>
<button onclick="validate()">Validate</button>
<button onclick="exercise()">Exercise</button>
<button onclick="refresh()">Refresh</button>

<h2>Load</h2>

<div style="background-color: azure; max-height: 10em; line-height: 1em;overflow: auto;float: right; width: 40%" id="result"></div>

<input type="text" id="load_address" size="40" value="0x9911c1ec8ac3713de638a683184899b32cbca2e7"/>
<button onclick="loadCallSpread()">Load from address</button>

<h2>Create</h2>

<table>
    <tr>
        <td>Buyer</td>
        <td><input type="text" id="buyers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Seller</td>
        <td><input type="text" id="sellers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Price Feed</td>
        <td><input type="text" id="price_feed_address" size="40" value="" /></td>
    </tr>
</table>

<p></p>
<table>
    <tr>
        <th></th>
        <th>Buy leg</th>
        <th>Sell leg</th>
    </tr>
    <tr>
        <td>Underlier</td>
        <td>
            <select id="buy_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
        <td>
            <select id="sell_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>Strike*</td>
        <td><input type="text" id="buy_strike" size="6" value="100" /></td>
        <td><input type="text" id="sell_strike" size="6" value="120" /></td>
    </tr>
    <tr>
        <td>Maturity (m)</td>
        <td><input type="text" id="buy_maturity" size="6" value="20" /></td>
        <td><input type="text" id="sell_maturity" size="6" value="20" /></td>
    </tr>
    <tr>
        <td>Notional (ETH)</td>
        <td><input type="text" id="buy_notional" size="6" value="1" /></td>
        <td><input type="text" id="sell_notional" size="6" value="1" /></td>
    </tr>
</table>

<button onclick="createContracts()">Create</button>

<p>*As percent of current spot.</p>

</body>
</html>