<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Call Spread</title>
    <script type="text/javascript" src="bower_components/bignumber.js/bignumber.min.js"></script>
    <script type="text/javascript" src="bower_components/web3/dist/web3.js"></script>
    <script>

        function logToScreen(message) {
            var existing = document.getElementById('result').innerHTML;
            document.getElementById('result').innerHTML = existing + "<br/>" + message;
            var objDiv = document.getElementById('result');
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function refresh() {
            document.getElementById("call_spread_address").innerHTML = callSpread.address;
            document.getElementById("buy_leg_address").innerHTML = callSpread._buyerLeg();
            document.getElementById("sell_leg_address").innerHTML = callSpread._sellerLeg();

            document.getElementById("is_active").innerHTML = callSpread._isActive();
            document.getElementById("is_complete").innerHTML = callSpread._isComplete();
            document.getElementById("broker").innerHTML = callSpread._broker();
            document.getElementById("buyer").innerHTML = callSpread._buyer();
            document.getElementById("seller").innerHTML = callSpread._seller();
            document.getElementById("margin").innerHTML = callSpread._marginPct();
            document.getElementById("maturity").innerHTML = callSpread._maxTimeToMaturity();

            document.getElementById("buy_leg_underlier").innerHTML = web3.toUtf8(buyOption._feedName());
            document.getElementById("buy_leg_strike").innerHTML = buyOption._strikePrice();
            console.log(web3.toBigNumber(buyOption._strikePrice()));
            document.getElementById("buy_leg_maturity").innerHTML = new Date((buyOption._startTime() + buyOption._timeToMaturity())*10).toLocaleString();
            document.getElementById("buy_leg_notional").innerHTML = buyOption._notional();
            document.getElementById("buy_leg_active").innerHTML = buyOption._isActive();
            document.getElementById("buy_leg_mature").innerHTML = buyOption._isComplete();

            document.getElementById("sell_leg_underlier").innerHTML = web3.toUtf8(sellOption._feedName());
            document.getElementById("sell_leg_strike").innerHTML = sellOption._strikePrice();
            document.getElementById("sell_leg_maturity").innerHTML = new Date((sellOption._startTime() + sellOption._timeToMaturity())*10).toLocaleString();
            document.getElementById("sell_leg_notional").innerHTML = sellOption._notional();
            document.getElementById("sell_leg_active").innerHTML = sellOption._isActive();
            document.getElementById("sell_leg_mature").innerHTML = sellOption._isComplete();
        }


        function loadCallSpread(){
            var address = document.getElementById('load_address').value;
            callSpread = callSpreadContract.at(address);
            var buyOptionAddress = callSpread._buyerLeg();
            var sellOptionAddress = callSpread._sellerLeg();
            buyOption = feedBackedCallContract.at(buyOptionAddress);
            sellOption = feedBackedCallContract.at(sellOptionAddress);
            refresh();
        }

        function createBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating buy leg..");
                    buyOption = feedBackedCallContract.new(
                            {
                                from: web3.eth.accounts[0],
                                data: feedBackedCallBinary,
                                gas: 3000000
                            }, function (e, contract) {
                                //if (e != null)
                                //    reject(e);
                                if (typeof contract.address != 'undefined') {
                                    console.log(e, contract);
                                    console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                    document.getElementById('buy_leg_address').textContent = contract.address;
                                    logToScreen("Buy leg created at " + contract.address);
                                    resolve(contract);
                                }
                            });
            });
        }

        function createSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating sell leg..");
                sellOption = feedBackedCallContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: feedBackedCallBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('sell_leg_address').textContent = contract.address;
                                logToScreen("Sell leg created at " + contract.address);
                                resolve(contract);
                            }
                        });
            });
        }

        function createCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating call spread..");
                callSpread = callSpreadContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: callSpreadBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('call_spread_address').textContent = contract.address;
                                logToScreen("Call spread created at " + contract.address);
                                resolve(contract);
                            }
                        });
            });
        }

        function initializeBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing buy leg..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("buy_underlier").value;
                var strike = document.getElementById("buy_strike").value;
                var maturity = document.getElementById("buy_maturity").value;
                var notional = document.getElementById("buy_notional").value;
                buyOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized buy option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing sell leg..");
                var seller = document.getElementById("buyers_account_address").value; // buyer and seller inverted
                var buyer = document.getElementById("sellers_account_address").value; // for sell option.
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("sell_underlier").value;
                var strike = document.getElementById("sell_strike").value;
                var maturity = document.getElementById("sell_maturity").value;
                var notional = document.getElementById("sell_notional").value;
                sellOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized sell option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing call spread..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var buyLegAddress = document.getElementById("buy_leg_address").textContent;
                var sellLegAddress = document.getElementById("sell_leg_address").textContent;
                callSpread.initialize.sendTransaction(
                        seller,
                        buyer,
                        sellLegAddress,
                        buyLegAddress,
                        10,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized call spread.");
                            resolve(result);
                        }
                );
            });
        }

        function createContracts() {

            logToScreen("Creating contracts..");

            createBuyOption()
            .then(createSellOption)
            .then(createCallSpread)
            .then(initializeBuyOption)
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .then(function(value){logToScreen("Done creating contracts.")})
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function initializeContracts() {
            initializeBuyOption()
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function validate() {
            logToScreen("Validating..");

            callSpread.validate.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.validate.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent validation transaction: " +  result);
                        refresh();
                    }
            );
        }

        function withdraw() {
            logToScreen("Withdrawing..");

            callSpread.withdraw.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.withdraw.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent withdraw transaction: " +  result);
                        refresh();
                    }
            );
        }

        function exercise() {
            logToScreen("Exercising..");

            callSpread.exercise.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.exercise.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent exercise transaction: " +  result);
                        refresh();
                    }
            );
        }

        var callSpreadBinary = "60606040525b33600060026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506000600060006101000a81548160ff021916908302179055506000600060016101000a81548160ff021916908302179055505b6118d5806100716000396000f3606060405236156100ec576000357c010000000000000000000000000000000000000000000000000000000090048062e1ffbb146100ee57806325a34aca146101115780632a7ce0261461013457806338283a1f1461016d5780633ccfd60b146101905780634355f1ec146101b35780635c36b186146101ec5780636901f6681461020f5780638ec89e4f14610232578063913bb26314610255578063948ecc9914610278578063d32cb0fe146102b1578063d617d00a146102d4578063dd9bf9981461030d578063ecc7296b14610339578063f7013ef61461035c578063f86a3c8a146103ac576100ec565b005b6100fb60048050506104d2565b6040518082815260200191505060405180910390f35b61011e6004805050611775565b6040518082815260200191505060405180910390f35b610141600480505061043a565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61017a60048050506103e5565b6040518082815260200191505060405180910390f35b61019d6004805050610e3f565b6040518082815260200191505060405180910390f35b6101c06004805050610414565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101f960048050506118c1565b6040518082815260200191505060405180910390f35b61021c6004805050610b33565b6040518082815260200191505060405180910390f35b61023f6004805050610499565b6040518082815260200191505060405180910390f35b6102626004805050610460565b6040518082815260200191505060405180910390f35b61028560048050506104ac565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102be6004805050611120565b6040518082815260200191505060405180910390f35b6102e16004805050610473565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61032360048080359060200190919050506108e3565b6040518082815260200191505060405180910390f35b6103466004805050611477565b6040518082815260200191505060405180910390f35b61039660048080359060200190919080359060200190919080359060200190919080359060200190919080359060200190919050506104db565b6040518082815260200191505060405180910390f35b6103b960048050506103ee565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b60076000505481565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060019054906101000a900460ff1681565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900460ff1681565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60086000505481565b600082600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555083600660006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555081600760005081905550600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600860005081905550600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600860005054101561070357600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001506008600050819055505b84600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555085600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506108d86003600860005054026108e3565b505b95945050505050565b6000600060006001915060019050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610a0657600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081505b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610b1b57600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080505b818015610b255750805b9250610b2c565b5050919050565b6000600060009054906101000a900460ff1680610b5c5750600060019054906101000a900460ff165b15610b6a5760019050610e3c565b610b7b6003600860005054026108e3565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610cdb5750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610ce95760009050610e3c565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610e0c5750600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610e1a5760009050610e3c565b6001600060006101000a81548160ff0219169083021790555060019050610e3c565b90565b6000600060009054906101000a900460ff1615610e5f576000905061111d565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614158015610f0b5750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b8015610f655750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b15610f73576000905061111d565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015050600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015050600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060016101000a81548160ff021916908302179055506001905061111d565b90565b6000600060006001915060019050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561121f5761118c611775565b50600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081505b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561130757600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080505b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015080156114295750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001505b15611461576000600060006101000a81548160ff021916908302179055506001600060016101000a81548160ff021916908302179055505b81801561146b5750805b9250611472565b505090565b60006000600060006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001509350600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015092508284039150606460076000505483020490503073ffffffffffffffffffffffffffffffffffffffff163181111561168457600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d3073ffffffffffffffffffffffffffffffffffffffff16318303604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001505061174d565b3073ffffffffffffffffffffffffffffffffffffffff163181101561174c57600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db0823073ffffffffffffffffffffffffffffffffffffffff163103604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150505b5b803073ffffffffffffffffffffffffffffffffffffffff163114945061176e565b5050505090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ae4e7fdf604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150156118b557600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f11561000257505050506040518051906020015090506118be565b600090506118be565b90565b60006118cb611477565b90506118d2565b9056";
        var callSpreadABI = [{"constant":true,"inputs":[],"name":"_maxTimeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"returnMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_marginPct","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"ping","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_sellerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_broker","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"rebalanceMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"seller","type":"address"},{"name":"buyer","type":"address"},{"name":"sellerLeg","type":"address"},{"name":"buyerLeg","type":"address"},{"name":"marginPct","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"inputs":[],"type":"constructor"}];
        var feedBackedCallBinary = "60606040525b33600060026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506000600060006101000a81548160ff021916908302179055506000600060016101000a81548160ff021916908302179055505b61140b806100716000396000f360606040523615610119576000357c010000000000000000000000000000000000000000000000000000000090048063060057541461011b5780630b4a26da1461015457806316c9b880146101775780631990da7a1461019a57806320965255146101bd5780632a7ce026146101e05780633ccfd60b146102195780634355f1ec1461023c5780636901f668146102755780638ec89e4f14610298578063913bb263146102bb578063a28c76cc146102de578063a550f86d14610340578063ae4e7fdf14610382578063b570571e146103a5578063d32cb0fe146103c8578063d617d00a146103eb578063dc76fabc14610424578063dd9bf99814610447578063ebf3125314610473578063fa1acb5c1461049657610119565b005b6101286004805050611362565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101616004805050610551565b6040518082815260200191505060405180910390f35b610184600480505061055a565b6040518082815260200191505060405180910390f35b6101a76004805050610563565b6040518082815260200191505060405180910390f35b6101ca6004805050611340565b6040518082815260200191505060405180910390f35b6101ed600480505061052b565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102266004805050610c76565b6040518082815260200191505060405180910390f35b6102496004805050610505565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102826004805050610a9b565b6040518082815260200191505060405180910390f35b6102a560048050506104b9565b6040518082815260200191505060405180910390f35b6102c860048050506104cc565b6040518082815260200191505060405180910390f35b61032a600480803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190803590602001909190505061057e565b6040518082815260200191505060405180910390f35b6103566004808035906020019091905050611383565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61038f60048050506111f0565b6040518082815260200191505060405180910390f35b6103b2600480505061056c565b6040518082815260200191505060405180910390f35b6103d56004805050610e3b565b6040518082815260200191505060405180910390f35b6103f860048050506104df565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b610431600480505061129a565b6040518082815260200191505060405180910390f35b61045d600480803590602001909190505061084b565b6040518082815260200191505060405180910390f35b610480600480505061122a565b6040518082815260200191505060405180910390f35b6104a36004805050610575565b6040518082815260200191505060405180910390f35b600060009054906101000a900460ff1681565b600060019054906101000a900460ff1681565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60056000505481565b60066000505481565b60076000505481565b60096000505481565b600a6000505481565b600086600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555087600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555061075560036009600050540261084b565b5060008673ffffffffffffffffffffffffffffffffffffffff1614156107cd5761079e7f65746865722d63616d702f70726963652d666565640000000000000000000000611383565b600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506107f9565b85600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b8460056000508190555060648461080e61129a565b0204600660005081905550826007600050819055508160096000508190555042600a6000508190555060019050610840565b979650505050505050565b6000600060006001915060019050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561096e57600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081505b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610a8357600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080505b818015610a8d5750805b9250610a94565b5050919050565b6000600060009054906101000a900460ff1680610ac45750600060019054906101000a900460ff165b15610ad25760019050610c73565b610ae360036009600050540261084b565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610c435750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610c515760009050610c73565b6001600060006101000a81548160ff0219169083021790555060019050610c73565b90565b6000600060009054906101000a900460ff1615610c965760009050610e38565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614158015610d425750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b8015610d9c5750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b15610daa5760009050610e38565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060016101000a81548160ff0219169083021790555060019050610e38565b90565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610e9d57600090506111ed565b610ea56111f0565b1515610eb457600090506111ed565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f1935050505050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d60076000505460066000505402604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015050600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f11561000257505050506040518051906020015050600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d6007600050546110b461129a565b02604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150506000600060006101000a81548160ff021916908302179055506001600060016101000a81548160ff02191690830217905550600190506111ed565b90565b60006000603c600a6000505442030490506009600050548110151561121c576001915061122656611225565b60009150611226565b5b5090565b6000600061123661129a565b9050600660005054811015611271577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff915061129656611295565b60066000505481111561128b576001915061129656611294565b60009150611296565b5b5b5090565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166331d98b3f600560005054604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150905061133d565b90565b600060076000505460066000505461135661129a565b0302905061135f565b90565b600073985509582b2c38010bfaa3c8d2be60022d3d00da9050611380565b90565b600061138d611362565b73ffffffffffffffffffffffffffffffffffffffff1663bb34534c83604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001509050611406565b91905056";
        var feedBackedCallABI = [{"constant":false,"inputs":[],"name":"nameRegAddress","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_feedName","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[],"name":"_strikePrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_notional","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"getValue","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"seller","type":"address"},{"name":"buyer","type":"address"},{"name":"feedProvider","type":"address"},{"name":"feedName","type":"bytes32"},{"name":"strikeToMarketRatioPct","type":"uint256"},{"name":"notional","type":"uint256"},{"name":"timeToMaturity","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"}],"name":"named","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"isMature","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_timeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_broker","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"getSpotPrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getMoneyness","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_startTime","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"}]
                ;

        var web3 = require('web3');
        web3.setProvider(new web3.providers.HttpProvider('http://localhost:56000'));
        var callSpreadContract = web3.eth.contract(callSpreadABI);
        var callSpread;
        var feedBackedCallContract = web3.eth.contract(feedBackedCallABI);
        var buyOption;
        var sellOption;

    </script>
</head>
<body>
<h1>Call Spread</h1>

<h2>Manage</h2>

<table cellpadding="5" style="font-size: small">
    <tr>
        <td>
            <div style="font-size: x-small">
                <p>Call spread</p>

                <p id="call_spread_address">0x0000000000000000000000000000000000000000</p>

                <p>Buy leg</p>

                <p id="buy_leg_address">0x0000000000000000000000000000000000000000</p>

                <p>Sell leg</p>

                <p id="sell_leg_address">0x0000000000000000000000000000000000000000</p>
            </div>
        </td>
        <td>
            <table>
                <tr>
                    <th></th>
                    <th>Buy leg</th>
                    <th>Sell leg</th>
                </tr>
                <tr>
                    <td>Underlier</td>
                    <td id="buy_leg_underlier"></td>
                    <td id="sell_leg_underlier"></td>
                </tr>
                <tr>
                    <td>Strike</td>
                    <td id="buy_leg_strike"></td></td>
                    <td id="sell_leg_strike"></td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="buy_leg_maturity"></td>
                    <td id="sell_leg_maturity"></td>
                </tr>
                <tr>
                    <td>Notional</td>
                    <td id="buy_leg_notional"></td>
                    <td id="sell_leg_notional"></td>
                </tr>
                <tr>
                    <td>Validated?</td>
                    <td id="buy_leg_active"></td>
                    <td id="sell_leg_active"></td>
                </tr>
                <tr>
                    <td>Mature?</td>
                    <td id="buy_leg_mature"></td>
                    <td id="sell_leg_mature"></td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <tr>
                    <td>Is Active?</td>
                    <td id="is_active">N/A</td>
                </tr>
                <tr>
                    <td>Is Complete?</td>
                    <td id="is_complete">N/A</td>
                </tr>
                <tr>
                    <td>Broker</td>
                    <td id="broker">N/A</td>
                </tr>
                <tr>
                    <td>Buyer</td>
                    <td id="buyer">N/A</td>
                </tr>
                <tr>
                    <td>Seller</td>
                    <td id="seller">N/A</td>
                </tr>
                <tr>
                    <td>Margin (%)</td>
                    <td id="margin">N/A</td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="maturity">N/A</td>
                </tr>
            </table>
        </td>
    </tr>
</table>


<p/>


<p></p>

<button onclick="withdraw()">Withdraw</button>
<button onclick="validate()">Validate</button>
<button onclick="exercise()">Exercise</button>
<button onclick="refresh()">Refresh</button>

<h2>Load</h2>

<div style="background-color: azure; max-height: 10em; line-height: 1em;overflow: auto;float: right; width: 40%" id="result"></div>

<input type="text" id="load_address" size="40" value="0x9911c1ec8ac3713de638a683184899b32cbca2e7"/>
<button onclick="loadCallSpread()">Load from address</button>

<h2>Create</h2>

<table>
    <tr>
        <td>Buyer</td>
        <td><input type="text" id="buyers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Seller</td>
        <td><input type="text" id="sellers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Price Feed</td>
        <td><input type="text" id="price_feed_address" size="40" value="" /></td>
    </tr>
</table>

<p></p>
<table>
    <tr>
        <th></th>
        <th>Buy leg</th>
        <th>Sell leg</th>
    </tr>
    <tr>
        <td>Underlier</td>
        <td>
            <select id="buy_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
        <td>
            <select id="sell_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>Strike*</td>
        <td><input type="text" id="buy_strike" size="6" value="100" /></td>
        <td><input type="text" id="sell_strike" size="6" value="120" /></td>
    </tr>
    <tr>
        <td>Maturity (m)</td>
        <td><input type="text" id="buy_maturity" size="6" value="20" /></td>
        <td><input type="text" id="sell_maturity" size="6" value="20" /></td>
    </tr>
    <tr>
        <td>Notional (ETH)</td>
        <td><input type="text" id="buy_notional" size="6" value="1" /></td>
        <td><input type="text" id="sell_notional" size="6" value="1" /></td>
    </tr>
</table>

<button onclick="createContracts()">Create</button>

<p>*As percent of current spot.</p>

</body>
</html>