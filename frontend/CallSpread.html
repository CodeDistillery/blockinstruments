<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Call Spread</title>
    <script type="text/javascript" src="bower_components/bignumber.js/bignumber.min.js"></script>
    <script type="text/javascript" src="bower_components/web3/dist/web3.js"></script>
    <script>

        function logToScreen(message) {
            var existing = document.getElementById('result').innerHTML;
            document.getElementById('result').innerHTML = existing + "<br/>" + message;
            var objDiv = document.getElementById('result');
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function refresh() {
            document.getElementById("call_spread_address").innerHTML = callSpread.address;
            document.getElementById("buy_leg_address").innerHTML = callSpread._buyerLeg();
            document.getElementById("sell_leg_address").innerHTML = callSpread._sellerLeg();

            document.getElementById("is_active").innerHTML = callSpread._isActive();
            document.getElementById("is_complete").innerHTML = callSpread._isComplete();
            document.getElementById("broker").innerHTML = callSpread._owner();
            document.getElementById("buyer").innerHTML = callSpread._buyer();
            document.getElementById("seller").innerHTML = callSpread._seller();
            document.getElementById("margin").innerHTML = callSpread._marginPct();
            document.getElementById("maturity").innerHTML = callSpread._maxTimeToMaturity();

            document.getElementById("buy_leg_underlier").innerHTML = web3.toUtf8(buyOption._feedName());
            document.getElementById("buy_leg_strike").innerHTML = buyOption._strikePrice();
            document.getElementById("buy_leg_maturity").innerHTML = new Date((buyOption._startTime() + buyOption._timeToMaturity())*10).toLocaleString();
            document.getElementById("buy_leg_notional").innerHTML = buyOption._notional();
            document.getElementById("buy_leg_active").innerHTML = buyOption._isActive();
            document.getElementById("buy_leg_mature").innerHTML = buyOption._isComplete();

            document.getElementById("sell_leg_underlier").innerHTML = web3.toUtf8(sellOption._feedName());
            document.getElementById("sell_leg_strike").innerHTML = sellOption._strikePrice();
            document.getElementById("sell_leg_maturity").innerHTML = new Date((sellOption._startTime() + sellOption._timeToMaturity())*10).toLocaleString();
            document.getElementById("sell_leg_notional").innerHTML = sellOption._notional();
            document.getElementById("sell_leg_active").innerHTML = sellOption._isActive();
            document.getElementById("sell_leg_mature").innerHTML = sellOption._isComplete();
        }


        function handleEvent(error, log){
            if(!error) {
                console.log("Received Event: ", log.event);
                console.log(log);
                console.log("The args were: ");
                for (var arg in log.args) {
                    try {console.log(arg, "=>", web3.toUtf8(log.args[arg]));}
                    catch (e) {
                        if(log.args[arg].toString().startsWith("0x"))
                            console.log(arg, "=>", log.args[arg]);
                        else {
                            try {
                                console.log(arg, "=>", web3.toDecimal(log.args[arg]));
                            }
                            catch (e) {
                                console.log(arg, "=>", log.args[arg]);
                            }
                        }
                    }
                }
            }
        }


        function loadCallSpread(){
            var address = document.getElementById('load_address').value;
            callSpread = callSpreadContract.at(address);
            var buyOptionAddress = callSpread._buyerLeg();
            var sellOptionAddress = callSpread._sellerLeg();
            buyOption = feedBackedCallContract.at(buyOptionAddress);
            sellOption = feedBackedCallContract.at(sellOptionAddress);
            callSpread.allEvents().watch(handleEvent);
            buyOption.allEvents().watch(handleEvent);
            sellOption.allEvents().watch(handleEvent);
            refresh();
        }

        function createBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating buy leg..");
                    buyOption = feedBackedCallContract.new(
                            {
                                from: web3.eth.accounts[0],
                                data: feedBackedCallBinary,
                                gas: 3000000
                            }, function (e, contract) {
                                //if (e != null)
                                //    reject(e);
                                if (typeof contract.address != 'undefined') {
                                    console.log(e, contract);
                                    console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                    document.getElementById('buy_leg_address').textContent = contract.address;
                                    logToScreen("Buy leg created at " + contract.address);
                                    contract.allEvents().watch(handleEvent);
                                    resolve(contract);
                                }
                            });
            });
        }

        function createSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating sell leg..");
                sellOption = feedBackedCallContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: feedBackedCallBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('sell_leg_address').textContent = contract.address;
                                logToScreen("Sell leg created at " + contract.address);
                                contract.allEvents().watch(handleEvent);
                                resolve(contract);
                            }
                        });
            });
        }

        function createCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Creating call spread..");
                callSpread = callSpreadContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: callSpreadBinary,
                            gas: 3000000
                        }, function (e, contract) {
                            //if (e != null)
                            //    reject(e);
                            if (typeof contract.address != 'undefined') {
                                console.log(e, contract);
                                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                                document.getElementById('call_spread_address').textContent = contract.address;
                                logToScreen("Call spread created at " + contract.address);
                                contract.allEvents().watch(handleEvent);
                                resolve(contract);
                            }
                        });
            });
        }

        function initializeBuyOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing buy leg..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("buy_underlier").value;
                var strike = document.getElementById("buy_strike").value;
                var maturity = document.getElementById("buy_maturity").value;
                var notional = document.getElementById("buy_notional").value;
                buyOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized buy option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeSellOption() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing sell leg..");
                var seller = document.getElementById("buyers_account_address").value; // buyer and seller inverted
                var buyer = document.getElementById("sellers_account_address").value; // for sell option.
                var priceFeedAddress = document.getElementById("price_feed_address").value;
                var underlier = document.getElementById("sell_underlier").value;
                var strike = document.getElementById("sell_strike").value;
                var maturity = document.getElementById("sell_maturity").value;
                var notional = document.getElementById("sell_notional").value;
                sellOption.initialize.sendTransaction(
                        seller,
                        buyer,
                        priceFeedAddress,
                        underlier,
                        strike,
                        notional,
                        maturity,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized sell option.");
                            resolve(result);
                        }
                );
            });
        }

        function initializeCallSpread() {
            return new Promise(function(resolve, reject) {
                logToScreen("Initializing call spread..");
                var buyer = document.getElementById("buyers_account_address").value;
                var seller = document.getElementById("sellers_account_address").value;
                var buyLegAddress = document.getElementById("buy_leg_address").textContent;
                var sellLegAddress = document.getElementById("sell_leg_address").textContent;
                callSpread.initialize.sendTransaction(
                        seller,
                        buyer,
                        sellLegAddress,
                        buyLegAddress,
                        10,
                        {from: web3.eth.coinbase, value: 0, gas: 2000000},
                        function (err, result) {
                            if (err != null)
                                reject(err);
                            console.log(err, result);
                            logToScreen("Initialized call spread.");
                            resolve(result);
                        }
                );
            });
        }

        function createContracts() {

            logToScreen("Creating contracts..");

            createBuyOption()
            .then(createSellOption)
            .then(createCallSpread)
            .then(initializeBuyOption)
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .then(function(value){logToScreen("Done creating contracts.");refresh()})
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function initializeContracts() {
            initializeBuyOption()
            .then(initializeSellOption)
            .then(initializeCallSpread)
            .catch(function (error) {
                console.log(error);
                logToScreen("Could not create contracts. See console for details.");
            });
        }

        function validate() {
            logToScreen("Validating..");

            callSpread.validate.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.validate.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent validation transaction: " +  result);
                        refresh();
                    }
            );
        }

        function withdraw() {
            logToScreen("Withdrawing..");

            callSpread.withdraw.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.withdraw.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent withdraw transaction: " +  result);
                        refresh();
                    }
            );
        }

        function exercise() {
            logToScreen("Exercising..");

            callSpread.exercise.call(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Result will be: " + result);
                        refresh();
                    }
            );

            callSpread.exercise.sendTransaction(
                    {from: web3.eth.coinbase, value: 0, gas: 2000000},
                    function (err, result) {
                        console.log(err, result);
                        logToScreen("Sent exercise transaction: " +  result);
                        refresh();
                    }
            );
        }

        var callSpreadBinary = "60606040525b33600060026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506000600060006101000a81548160ff021916908302179055506000600060016101000a81548160ff021916908302179055505b61282f806100716000396000f360606040523615610102576000357c010000000000000000000000000000000000000000000000000000000090048062e1ffbb1461010457806325a34aca146101275780632a7ce0261461014a57806338283a1f146101835780633ccfd60b146101a65780634355f1ec146101c95780635c36b186146102025780636901f668146102255780638ec89e4f14610248578063913bb2631461026b578063948ecc991461028e578063b2bdfa7b146102c7578063caf19e5a14610300578063d32cb0fe14610384578063dd9bf998146103a7578063ecc7296b146103d3578063f03342ad146103f6578063f7013ef614610422578063f86a3c8a1461047257610102565b005b6101116004805050610598565b6040518082815260200191505060405180910390f35b61013460048050506124b1565b6040518082815260200191505060405180910390f35b610157600480505061051d565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b610190600480505061058f565b6040518082815260200191505060405180910390f35b6101b36004805050611522565b6040518082815260200191505060405180910390f35b6101d660048050506104f7565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61020f60048050506126a9565b6040518082815260200191505060405180910390f35b6102326004805050610d5b565b6040518082815260200191505060405180910390f35b61025560048050506104ab565b6040518082815260200191505060405180910390f35b61027860048050506104be565b6040518082815260200191505060405180910390f35b61029b6004805050610569565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102d460048050506104d1565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6103166004808035906020019091905050612789565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156103765780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6103916004805050611ae8565b6040518082815260200191505060405180910390f35b6103bd60048080359060200190919050506109a9565b6040518082815260200191505060405180910390f35b6103e06004805050612057565b6040518082815260200191505060405180910390f35b61040c60048080359060200190919050506126bd565b6040518082815260200191505060405180910390f35b61045c60048080359060200190919080359060200190919080359060200190919080359060200190919080359060200190919050506105a1565b6040518082815260200191505060405180910390f35b61047f6004805050610543565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600060009054906101000a900460ff1681565b600060019054906101000a900460ff1681565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60076000505481565b60086000505481565b600082600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555083600660006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555081600760005081905550600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600860005081905550600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015060086000505410156107c957600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b570571e604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001506008600050819055505b84600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555085600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555061099e6003600860005054026109a9565b505b95945050505050565b60006000600060019150600190506109e2600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166126bd565b15610b7d57600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610af284612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610b6e5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b610ba8600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166126bd565b15610d4357600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660086000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610cb883612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610d345780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b818015610d4d5750805b9250610d54565b5050919050565b600060006000600060009054906101000a900460ff1680610d885750600060019054906101000a900460ff165b15610e27577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f56616c69646174696f6e20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a16001925061151d565b610e386003600860005054026109a9565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610f985750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15611037577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602f8152602001807f56616c69646174696f6e20726571756972657320617574686f72697a6564207481526020017f726164696e67206163636f756e7473000000000000000000000000000000000081526020015060400191505060405180910390a16000925061151d565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015091507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b0781600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661111384612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561118f5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a181151561123e577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260278152602001807f56616c69646174696f6e2072657175697265732076616c69646174656420627581526020017f796572206c65670000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a16000925061151d565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16636901f668604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015090507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b0781600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661131a83612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156113965780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1801515611445577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260288152602001807f56616c69646174696f6e2072657175697265732076616c69646174656420736581526020017f6c6c6572206c656700000000000000000000000000000000000000000000000081526020015060400191505060405180910390a16000925061151d565b6001600060006101000a81548160ff021916908302179055507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b07813061148a6001612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156115065780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16001925061151d565b505090565b600060006000600060009054906101000a900460ff16156115d7577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f5769746864726177616c20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160009250611ae3565b611602600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166126bd565b806116345750611633600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166126bd565b5b156116d3577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602b8152602001807f5769746864726177616c206d75737420626520696e697469617465642062792081526020017f7061727469636970616e7400000000000000000000000000000000000000000081526020015060400191505060405180910390a160009250611ae3565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015091507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea9600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166117af84612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561182b5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633ccfd60b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015090507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea9600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661191583612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156119915780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060016101000a81548160ff021916908302179055507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea930611a506001612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611acc5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019250611ae3565b505090565b6000600060006001915060019050611b21600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166126bd565b15611c9857611b2e6124b1565b50600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611c0d84612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611c895780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b611cc3600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166126bd565b15611e3157600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d32cb0fe604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611da683612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611e225780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001508015611f535750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663913bb263604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001505b15612041576000600060006101000a81548160ff021916908302179055506001600060016101000a81548160ff021916908302179055507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd30611fb66001612789565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156120325780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b81801561204b5750805b9250612052565b505090565b60006000600060006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001509350600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166320965255604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f115610002575050506040518051906020015092508284039150606460076000505483020490503073ffffffffffffffffffffffffffffffffffffffff1631811115612312577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d582410600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16303073ffffffffffffffffffffffffffffffffffffffff16318403604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d3073ffffffffffffffffffffffffffffffffffffffff16318303604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015050612489565b3073ffffffffffffffffffffffffffffffffffffffff1631811015612488577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d58241030600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16833073ffffffffffffffffffffffffffffffffffffffff163103604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db0823073ffffffffffffffffffffffffffffffffffffffff163103604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150505b5b803073ffffffffffffffffffffffffffffffffffffffff16311494506124aa565b5050505090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ae4e7fdf604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f11561000257505050604051805190602001501561269d577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d58241030600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f11561000257505050506040518051906020015090506126a6565b600090506126a6565b90565b60006126b3612057565b90506126ba565b90565b60008173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16148061277d57508173ffffffffffffffffffffffffffffffffffffffff163273ffffffffffffffffffffffffffffffffffffffff1614801561277c5750600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b5b9050612784565b919050565b602060405190810160405280600081526020015081156127e857604060405190810160405280600781526020017f5355434345535300000000000000000000000000000000000000000000000000815260200150905061282a56612829565b604060405190810160405280600781526020017f4641494c55524500000000000000000000000000000000000000000000000000815260200150905061282a565b5b91905056";
        var callSpreadABI = [{"constant":true,"inputs":[],"name":"_maxTimeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"returnMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_marginPct","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"ping","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_sellerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_owner","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"flag","type":"bool"}],"name":"toText","outputs":[{"name":"","type":"bytes"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"rebalanceMargin","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"initiatedBy","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"sellerAcct","type":"address"},{"name":"buyerAcct","type":"address"},{"name":"sellerLeg","type":"address"},{"name":"buyerLeg","type":"address"},{"name":"marginPct","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyerLeg","outputs":[{"name":"","type":"address"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"bytes"}],"name":"Error","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Authorization","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Validation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Exercise","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"CashFlow","type":"event"}];
        var feedBackedCallBinary = "60606040525b33600060026101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506000600060006101000a81548160ff021916908302179055506000600060016101000a81548160ff021916908302179055505b611ea1806100716000396000f36060604052361561012f576000357c01000000000000000000000000000000000000000000000000000000009004806306005754146101315780630b4a26da1461016a57806316c9b8801461018d5780631990da7a146101b057806320965255146101d35780632a7ce026146101f65780633ccfd60b1461022f5780634355f1ec146102525780636901f6681461028b5780638ec89e4f146102ae578063913bb263146102d1578063a28c76cc146102f4578063a550f86d14610356578063ae4e7fdf14610398578063b2bdfa7b146103bb578063b570571e146103f4578063caf19e5a14610417578063d32cb0fe1461049b578063dc76fabc146104be578063dd9bf998146104e1578063ebf312531461050d578063f03342ad14610530578063fa1acb5c1461055c5761012f565b005b61013e6004805050611df8565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101776004805050610617565b6040518082815260200191505060405180910390f35b61019a6004805050610620565b6040518082815260200191505060405180910390f35b6101bd6004805050610629565b6040518082815260200191505060405180910390f35b6101e06004805050611c64565b6040518082815260200191505060405180910390f35b61020360048050506105f1565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61023c6004805050611076565b6040518082815260200191505060405180910390f35b61025f60048050506105cb565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102986004805050610cc3565b6040518082815260200191505060405180910390f35b6102bb600480505061057f565b6040518082815260200191505060405180910390f35b6102de6004805050610592565b6040518082815260200191505060405180910390f35b6103406004808035906020019091908035906020019091908035906020019091908035906020019091908035906020019091908035906020019091908035906020019091905050610644565b6040518082815260200191505060405180910390f35b61036c6004808035906020019091905050611e19565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6103a56004805050611b14565b6040518082815260200191505060405180910390f35b6103c860048050506105a5565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6104016004805050610632565b6040518082815260200191505060405180910390f35b61042d6004808035906020019091905050611d52565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561048d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6104a8600480505061136a565b6040518082815260200191505060405180910390f35b6104cb6004805050611bbe565b6040518082815260200191505060405180910390f35b6104f76004808035906020019091905050610911565b6040518082815260200191505060405180910390f35b61051a6004805050611b4e565b6040518082815260200191505060405180910390f35b6105466004808035906020019091905050611c86565b6040518082815260200191505060405180910390f35b610569600480505061063b565b6040518082815260200191505060405180910390f35b600060009054906101000a900460ff1681565b600060019054906101000a900460ff1681565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60056000505481565b60066000505481565b60076000505481565b60096000505481565b600a6000505481565b600086600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555087600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663b2bdfa7b604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506020604051808303816000876161da5a03f1156100025750505060405180519060200150600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555061081b600360096000505402610911565b5060008673ffffffffffffffffffffffffffffffffffffffff161415610893576108647f65746865722d63616d702f70726963652d666565640000000000000000000000611e19565b600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506108bf565b85600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b846005600050819055506064846108d4611bbe565b0204600660005081905550826007600050819055508160096000508190555042600a6000508190555060019050610906565b979650505050505050565b600060006000600191506001905061094a600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611c86565b15610ae557600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150915081507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610a5a84611d52565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610ad65780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b610b10600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611c86565b15610cab57600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c1dbd9b2308660096000505401604051837c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001925050506020604051808303816000876161da5a03f1156100025750505060405180519060200150905080507f70ff76a87b888f32d6cf303cd228f8cf96566a85d44b969bf435422de2fa95da600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610c2083611d52565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015610c9c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15b818015610cb55750805b9250610cbc565b5050919050565b6000600060009054906101000a900460ff1680610cec5750600060019054906101000a900460ff165b15610d8b577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f56616c69646174696f6e20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160019050611073565b610d9c600360096000505402610911565b50600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001501580610efc5750600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe9fbb8030604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150155b15610f9b577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602f8152602001807f56616c69646174696f6e20726571756972657320617574686f72697a6564207481526020017f726164696e67206163636f756e7473000000000000000000000000000000000081526020015060400191505060405180910390a160009050611073565b6001600060006101000a81548160ff021916908302179055507fb44e0af213ece6f3aab6c5d4ac88b2fb69bc37851ea73e7b11718e585e7b078130610fe06001611d52565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561105c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019050611073565b90565b6000600060009054906101000a900460ff1615611127577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260258152602001807f5769746864726177616c20726571756972657320696e61637469766520636f6e81526020017f747261637400000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160009050611367565b611152600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611c86565b806111845750611183600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611c86565b5b15611223577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252602b8152602001807f5769746864726177616c206d75737420626520696e697469617465642062792081526020017f7061727469636970616e7400000000000000000000000000000000000000000081526020015060400191505060405180910390a160009050611367565b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f19350505050506001600060016101000a81548160ff021916908302179055507fe5931718848ec5427509210911211a718db19ddb36fde61b127b34eb80019ea9306112d46001611d52565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156113505780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019050611367565b90565b6000611397600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611c86565b1515611437577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc6040518080602001828103825260238152602001807f4578657263697365206d75737420626520696e6974696174656420627920627581526020017f796572000000000000000000000000000000000000000000000000000000000081526020015060400191505060405180910390a160009050611b11565b61143f611b14565b15156114b9577fc75fb740d515c4fc862cc5c8f95343266e804872e7206e24f75751db41c4bcdc60405180806020018281038252601a8152602001807f4578657263697365207265717569726573206d6174757269747900000000000081526020015060200191505060405180910390a160009050611b11565b60003073ffffffffffffffffffffffffffffffffffffffff16311115611586577fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d58241030600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1660003073ffffffffffffffffffffffffffffffffffffffff1631604051809050600060405180830381858888f1935050505050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d60076000505460066000505402604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150507fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d582410600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f11561000257505050506040518051906020015050600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16632e1a7d4d600760005054611854611bbe565b02604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f1156100025750505060405180519060200150507fec106815f3bcc94faea9ba36bcca01ef908f1279e98e9504ec6d5bce2d582410600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808473ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a1600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db03073ffffffffffffffffffffffffffffffffffffffff1631604051827c010000000000000000000000000000000000000000000000000000000002815260040180905060206040518083038185886185025a03f115610002575050505060405180519060200150506000600060006101000a81548160ff021916908302179055506001600060016101000a81548160ff021916908302179055507fe593aea7df942d99ef64601dc3fa550d7c204bd3bf4f5f317af7bd1b237739fd30611a7e6001611d52565b604051808373ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f168015611afa5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160019050611b11565b90565b60006000603c600a60005054420304905060096000505481101515611b405760019150611b4a56611b49565b60009150611b4a565b5b5090565b60006000611b5a611bbe565b9050600660005054811015611b95577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9150611bba56611bb9565b600660005054811115611baf5760019150611bba56611bb8565b60009150611bba565b5b5b5090565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166331d98b3f600560005054604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001509050611c61565b90565b6000600760005054600660005054611c7a611bbe565b03029050611c83565b90565b60008173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480611d4657508173ffffffffffffffffffffffffffffffffffffffff163273ffffffffffffffffffffffffffffffffffffffff16148015611d455750600060029054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b5b9050611d4d565b919050565b60206040519081016040528060008152602001508115611db157604060405190810160405280600781526020017f53554343455353000000000000000000000000000000000000000000000000008152602001509050611df356611df2565b604060405190810160405280600781526020017f4641494c555245000000000000000000000000000000000000000000000000008152602001509050611df3565b5b919050565b600073985509582b2c38010bfaa3c8d2be60022d3d00da9050611e16565b90565b6000611e23611df8565b73ffffffffffffffffffffffffffffffffffffffff1663bb34534c83604051827c0100000000000000000000000000000000000000000000000000000000028152600401808281526020019150506020604051808303816000876161da5a03f11561000257505050604051805190602001509050611e9c565b91905056";
        var feedBackedCallABI = [{"constant":false,"inputs":[],"name":"nameRegAddress","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_feedName","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[],"name":"_strikePrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_notional","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"getValue","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":true,"inputs":[],"name":"_seller","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_buyer","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isActive","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_isComplete","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"sellerAcct","type":"address"},{"name":"buyerAcct","type":"address"},{"name":"feedProvider","type":"address"},{"name":"feedName","type":"bytes32"},{"name":"strikeToMarketRatioPct","type":"uint256"},{"name":"notional","type":"uint256"},{"name":"timeToMaturity","type":"uint256"}],"name":"initialize","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"}],"name":"named","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"isMature","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_owner","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"_timeToMaturity","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"flag","type":"bool"}],"name":"toText","outputs":[{"name":"","type":"bytes"}],"type":"function"},{"constant":false,"inputs":[],"name":"exercise","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getSpotPrice","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"buffer","type":"uint256"}],"name":"authorizeTradingAccounts","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"getMoneyness","outputs":[{"name":"","type":"int256"}],"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"initiatedBy","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"_startTime","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"bytes"}],"name":"Error","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Authorization","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Validation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Withdrawal","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"outcome","type":"bytes"}],"name":"Exercise","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"CashFlow","type":"event"}];

        var web3 = require('web3');
        web3.setProvider(new web3.providers.HttpProvider('http://localhost:56000'));
        var callSpreadContract = web3.eth.contract(callSpreadABI);
        var callSpread;
        var feedBackedCallContract = web3.eth.contract(feedBackedCallABI);
        var buyOption;
        var sellOption;

    </script>
</head>
<body>
<h1>Call Spread</h1>

<h2>Manage</h2>

<table cellpadding="5" style="font-size: small">
    <tr>
        <td>
            <div style="font-size: x-small">
                <p>Call spread</p>

                <p id="call_spread_address">0x0000000000000000000000000000000000000000</p>

                <p>Buy leg</p>

                <p id="buy_leg_address">0x0000000000000000000000000000000000000000</p>

                <p>Sell leg</p>

                <p id="sell_leg_address">0x0000000000000000000000000000000000000000</p>
            </div>
        </td>
        <td>
            <table>
                <tr>
                    <th></th>
                    <th>Buy leg</th>
                    <th>Sell leg</th>
                </tr>
                <tr>
                    <td>Underlier</td>
                    <td id="buy_leg_underlier"></td>
                    <td id="sell_leg_underlier"></td>
                </tr>
                <tr>
                    <td>Strike</td>
                    <td id="buy_leg_strike"></td></td>
                    <td id="sell_leg_strike"></td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="buy_leg_maturity"></td>
                    <td id="sell_leg_maturity"></td>
                </tr>
                <tr>
                    <td>Notional</td>
                    <td id="buy_leg_notional"></td>
                    <td id="sell_leg_notional"></td>
                </tr>
                <tr>
                    <td>Validated?</td>
                    <td id="buy_leg_active"></td>
                    <td id="sell_leg_active"></td>
                </tr>
                <tr>
                    <td>Mature?</td>
                    <td id="buy_leg_mature"></td>
                    <td id="sell_leg_mature"></td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <tr>
                    <td>Is Active?</td>
                    <td id="is_active">N/A</td>
                </tr>
                <tr>
                    <td>Is Complete?</td>
                    <td id="is_complete">N/A</td>
                </tr>
                <tr>
                    <td>Broker</td>
                    <td id="broker">N/A</td>
                </tr>
                <tr>
                    <td>Buyer</td>
                    <td id="buyer">N/A</td>
                </tr>
                <tr>
                    <td>Seller</td>
                    <td id="seller">N/A</td>
                </tr>
                <tr>
                    <td>Margin (%)</td>
                    <td id="margin">N/A</td>
                </tr>
                <tr>
                    <td>Maturity</td>
                    <td id="maturity">N/A</td>
                </tr>
            </table>
        </td>
    </tr>
</table>


<p/>


<p></p>

<button onclick="withdraw()">Withdraw</button>
<button onclick="validate()">Validate</button>
<button onclick="exercise()">Exercise</button>
<button onclick="refresh()">Refresh</button>

<h2>Load</h2>

<div style="background-color: azure; max-height: 10em; line-height: 1em;overflow: auto;float: right; width: 40%" id="result"></div>

<input type="text" id="load_address" size="40" value="0x9911c1ec8ac3713de638a683184899b32cbca2e7"/>
<button onclick="loadCallSpread()">Load from address</button>

<h2>Create</h2>

<table>
    <tr>
        <td>Buyer</td>
        <td><input type="text" id="buyers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Seller</td>
        <td><input type="text" id="sellers_account_address" size="40" value="" /></td>
    </tr>
    <tr>
        <td>Price Feed</td>
        <td><input type="text" id="price_feed_address" size="40" value="" /></td>
    </tr>
</table>

<p></p>
<table>
    <tr>
        <th></th>
        <th>Buy leg</th>
        <th>Sell leg</th>
    </tr>
    <tr>
        <td>Underlier</td>
        <td>
            <select id="buy_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
        <td>
            <select id="sell_underlier">
                <option>USD_ETH</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>Strike*</td>
        <td><input type="text" id="buy_strike" size="6" value="100" /></td>
        <td><input type="text" id="sell_strike" size="6" value="120" /></td>
    </tr>
    <tr>
        <td>Maturity (m)</td>
        <td><input type="text" id="buy_maturity" size="6" value="20" /></td>
        <td><input type="text" id="sell_maturity" size="6" value="20" /></td>
    </tr>
    <tr>
        <td>Notional (ETH)</td>
        <td><input type="text" id="buy_notional" size="6" value="1" /></td>
        <td><input type="text" id="sell_notional" size="6" value="1" /></td>
    </tr>
</table>

<button onclick="createContracts()">Create</button>

<p>*As percent of current spot.</p>

</body>
</html>