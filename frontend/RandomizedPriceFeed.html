<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Randomized Price Feed</title>
    <script type="text/javascript" src="bower_components/bignumber.js/bignumber.min.js"></script>
    <script type="text/javascript" src="bower_components/web3/dist/web3.js"></script>
    <script>

        function logToScreen(message)
        {
            document.getElementById('result').textContent = message;
        }

        function createFeed(){
            logToScreen("Creating price feed..");
            priceFeed = priceFeedContract.new(
                    {
                        from: web3.eth.accounts[0],
                        data: '60606040525b620a46c6600160005060007f5553445f4554480000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555061088d600160005060007f4254435f455448000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506310fcc140600160005060007f555344545f4254430000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506210d114600160005060007f455552555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555062175e6c600160005060007f47425055534400000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506307390f60600160005060007f5553444a505900000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506345502400600160005060007f584155555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555062f15d10600160005060007f5841475553440000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550637bb046b0600160005060007f5350353030000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550637fffffff600160005060007f4e415344415100000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506307190440600160005060007f4141504c000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506329d7ab80600160005060007f474f4f4700000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550630326bb70600160005060007f4d534654000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506302248db0600160005060007f474d0000000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506303799660600160005060007f574d54000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555062ef1af0600160005060007f4600000000000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550630202d4e0600160005060007f540000000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f5553445f4554480000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f4254435f4554480000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f555344545f42544300000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f455552555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f474250555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f5553444a5059000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f584155555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f584147555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f535035303000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f4e4153444151000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f4141504c0000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f474f4f470000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f4d5346540000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f474d00000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f574d54000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f460000000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600260005060007f5400000000000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550600360005080548060010182818154818355818115116108d0578183600052602060002091820191016108cf91906108b1565b808211156108cb57600081815060009055506001016108b1565b5090565b5b5050509190906000526020600020900160005b7f5553445f45544800000000000000000000000000000000000000000000000000909190915055506003600050805480600101828181548183558181151161095d5781836000526020600020918201910161095c919061093e565b80821115610958576000818150600090555060010161093e565b5090565b5b5050509190906000526020600020900160005b7f4254435f4554480000000000000000000000000000000000000000000000000090919091505550600360005080548060010182818154818355818115116109ea578183600052602060002091820191016109e991906109cb565b808211156109e557600081815060009055506001016109cb565b5090565b5b5050509190906000526020600020900160005b7f555344545f4254430000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610a7757818360005260206000209182019101610a769190610a58565b80821115610a725760008181506000905550600101610a58565b5090565b5b5050509190906000526020600020900160005b7f45555255534400000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610b0457818360005260206000209182019101610b039190610ae5565b80821115610aff5760008181506000905550600101610ae5565b5090565b5b5050509190906000526020600020900160005b7f47425055534400000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610b9157818360005260206000209182019101610b909190610b72565b80821115610b8c5760008181506000905550600101610b72565b5090565b5b5050509190906000526020600020900160005b7f5553444a505900000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610c1e57818360005260206000209182019101610c1d9190610bff565b80821115610c195760008181506000905550600101610bff565b5090565b5b5050509190906000526020600020900160005b7f58415555534400000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610cab57818360005260206000209182019101610caa9190610c8c565b80821115610ca65760008181506000905550600101610c8c565b5090565b5b5050509190906000526020600020900160005b7f58414755534400000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610d3857818360005260206000209182019101610d379190610d19565b80821115610d335760008181506000905550600101610d19565b5090565b5b5050509190906000526020600020900160005b7f53503530300000000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610dc557818360005260206000209182019101610dc49190610da6565b80821115610dc05760008181506000905550600101610da6565b5090565b5b5050509190906000526020600020900160005b7f4e415344415100000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610e5257818360005260206000209182019101610e519190610e33565b80821115610e4d5760008181506000905550600101610e33565b5090565b5b5050509190906000526020600020900160005b7f4141504c000000000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610edf57818360005260206000209182019101610ede9190610ec0565b80821115610eda5760008181506000905550600101610ec0565b5090565b5b5050509190906000526020600020900160005b7f474f4f47000000000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610f6c57818360005260206000209182019101610f6b9190610f4d565b80821115610f675760008181506000905550600101610f4d565b5090565b5b5050509190906000526020600020900160005b7f4d534654000000000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511610ff957818360005260206000209182019101610ff89190610fda565b80821115610ff45760008181506000905550600101610fda565b5090565b5b5050509190906000526020600020900160005b7f474d0000000000000000000000000000000000000000000000000000000000009091909150555060036000508054806001018281815481835581811511611086578183600052602060002091820191016110859190611067565b808211156110815760008181506000905550600101611067565b5090565b5b5050509190906000526020600020900160005b7f574d54000000000000000000000000000000000000000000000000000000000090919091505550600360005080548060010182818154818355818115116111135781836000526020600020918201910161111291906110f4565b8082111561110e57600081815060009055506001016110f4565b5090565b5b5050509190906000526020600020900160005b7f460000000000000000000000000000000000000000000000000000000000000090919091505550600360005080548060010182818154818355818115116111a05781836000526020600020918201910161119f9190611181565b8082111561119b5760008181506000905550600101611181565b5090565b5b5050509190906000526020600020900160005b7f5400000000000000000000000000000000000000000000000000000000000000909190915055505b6101f4806111ea6000396000f360606040526000357c01000000000000000000000000000000000000000000000000000000009004806331d98b3f1461005a57806356050f4714610086578063d45c4435146100b2578063dc555090146100de57610058565b005b610070600480803590602001909190505061012f565b6040518082815260200191505060405180910390f35b61009c600480803590602001909190505061010a565b6040518082815260200191505060405180910390f35b6100c860048080359060200190919050506101cc565b6040518082815260200191505060405180910390f35b6100eb6004805050610101565b6040518082815260200191505060405180910390f35b60006000505481565b600360005081815481101561000257906000526020600020900160005b915090505481565b60006000600060016000506000858152602001908152602001600020600050549150600a82049050600060024306141561016f5780820191508150610177565b808203915081505b816001600050600086815260200190815260200160002060005081905550426000600050819055504260026000506000868152602001908152602001600020600050819055508192506101c5565b5050919050565b6000600260005060008381526020019081526020016000206000505490506101ef565b91905056',
                        gas: 3000000
                    }, function(e, contract){
                        if (typeof contract.address != 'undefined') {
                            console.log(e, contract);
                            console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                            document.getElementById('address').value = contract.address;
                            logToScreen("New price feed created at " + contract.address);
                            refreshFeed();
                        }
                    });
        }

        function loadFeed(){
            logToScreen("Loading price feed..");
            var address = document.getElementById('address').value;
            priceFeed = priceFeedContract.at(address);
            console.log(priceFeed);
            logToScreen("Loaded price feed.");
            refreshFeed();
        }

        function refreshFeed(){
            var prices = "<tr><td>Symbol</td><td>Price</td><td>Timestamp</td></tr>";
            for(var i=0; i<symbols.length; i++) {
                var result = priceFeed.getPrice.call(symbols[i]);
                var price = result.c[0] /1e6;
                result = priceFeed.getTimestamp.call(symbols[i]);
                var timestamp =  result.c[0];
                prices += "<tr><td>" + symbols[i] + "</td><td>" + price + "</td><td>" + timestamp + "</td></tr>";
            }
            document.getElementById('prices').innerHTML = prices;
        }

        var web3 = require('web3');
        web3.setProvider(new web3.providers.HttpProvider('http://localhost:56000'));
        var abi = [{"constant":false,"inputs":[{"name":"symbol","type":"bytes32"}],"name":"getPrice","outputs":[{"name":"currPrice","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"_symbols","outputs":[{"name":"","type":"bytes32"}],"type":"function"},{"constant":false,"inputs":[{"name":"symbol","type":"bytes32"}],"name":"getTimestamp","outputs":[{"name":"timestamp","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"updateTime","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"}];
        var priceFeedContract = web3.eth.contract(abi);
        var priceFeed;
        var symbols = ['USD_ETH', 'BTC_ETH', 'USDT_BTC', 'EURUSD', 'GBPUSD', 'USDJPY', 'XAUUSD', 'XAGUSD', 'SP500', 'NASDAQ', 'AAPL', 'GOOG', 'MSFT', 'GM', 'WMT', 'F', 'T'];
    </script>
</head>
<body>
    <h1>Randomized Price Feed</h1>

    <div style="background-color: azure " id="result"></div>

    <input type="text" id="address" size="40" />
    <button onclick="createFeed()">Create</button>
    <button onclick="loadFeed()">Load</button>
    <button onclick="refreshFeed()">Refresh</button>

    <p>Prices</p>
    <table id="prices"></table>
</body>
</html>