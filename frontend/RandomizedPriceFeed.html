<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Randomized Price Feed</title>
    <script type="text/javascript" src="bower_components/bignumber.js/bignumber.min.js"></script>
    <script type="text/javascript" src="bower_components/web3/dist/web3.js"></script>
    <script>

        function logToScreen(message)
        {
            document.getElementById('result').textContent = message;
        }

        function createFeed(){
            logToScreen("Creating price feed..");
            priceFeed = priceFeedContract.new(
                    {
                        from: web3.eth.accounts[0],
                        data: '60606040525b620a46c6600260005060007f5553445f4554480000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555061088d600260005060007f4254435f455448000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506310fcc140600260005060007f555344545f4254430000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506210d114600260005060007f455552555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555062175e6c600260005060007f47425055534400000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506307390f60600260005060007f5553444a505900000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506345502400600260005060007f584155555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555062f15d10600260005060007f5841475553440000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550637bb046b0600260005060007f5350353030000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550637fffffff600260005060007f4e415344415100000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506307190440600260005060007f4141504c000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506329d7ab80600260005060007f474f4f4700000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550630326bb70600260005060007f4d534654000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506302248db0600260005060007f474d0000000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055506303799660600260005060007f574d54000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555062ef1af0600260005060007f4600000000000000000000000000000000000000000000000000000000000000815260200190815260200160002060005081905550630202d4e0600260005060007f540000000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f5553445f4554480000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f4254435f4554480000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f555344545f42544300000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f455552555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f474250555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f5553444a5059000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f584155555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f584147555344000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f535035303000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f4e4153444151000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f4141504c0000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f474f4f470000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f4d5346540000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f474d00000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f574d54000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f460000000000000000000000000000000000000000000000000000000000000081526020019081526020016000206000508190555042600360005060007f54000000000000000000000000000000000000000000000000000000000000008152602001908152602001600020600050819055505b6101988061088d6000396000f360606040526000357c01000000000000000000000000000000000000000000000000000000009004806331d98b3f1461004f578063d45c44351461007b578063dc555090146100a75761004d565b005b61006560048080359060200190919050506100d3565b6040518082815260200191505060405180910390f35b6100916004808035906020019091905050610170565b6040518082815260200191505060405180910390f35b6100b460048050506100ca565b6040518082815260200191505060405180910390f35b60016000505481565b60006000600060026000506000858152602001908152602001600020600050549150600a820490506000600243061415610113578082019150815061011b565b808203915081505b81600260005060008681526020019081526020016000206000508190555042600160005081905550426003600050600086815260200190815260200160002060005081905550819250610169565b5050919050565b600060036000506000838152602001908152602001600020600050549050610193565b91905056',
                        gas: 3000000
                    }, function(e, contract){
                        if (typeof contract.address != 'undefined') {
                            console.log(e, contract);
                            console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                            document.getElementById('address').value = contract.address;
                            logToScreen("New price feed created at " + contract.address);
                            refreshFeed();
                        }
                    });
        }

        function loadFeed(){
            logToScreen("Loading price feed..");
            var address = document.getElementById('address').value;
            priceFeed = priceFeedContract.at(address);
            console.log(priceFeed);
            logToScreen("Loaded price feed.");
            refreshFeed();
        }

        function refreshFeed(){
            var prices = "<tr><td>Symbol</td><td>Price</td><td>Timestamp</td></tr>";
            for(var i=0; i<symbols.length; i++) {
                var result = priceFeed.getPrice.call(symbols[i]);
                var price = result.c[0] /1e6;
                result = priceFeed.getTimestamp.call(symbols[i]);
                var timestamp =  result.c[0];
                prices += "<tr><td>" + symbols[i] + "</td><td>" + price + "</td><td>" + timestamp + "</td></tr>";
            }
            document.getElementById('prices').innerHTML = prices;
        }

        var web3 = require('web3');
        web3.setProvider(new web3.providers.HttpProvider('http://localhost:56000'));
        var abi = [{"constant":false,"inputs":[{"name":"symbol","type":"bytes32"}],"name":"getPrice","outputs":[{"name":"currPrice","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"symbol","type":"bytes32"}],"name":"getTimestamp","outputs":[{"name":"timestamp","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"updateTime","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"}];
        var priceFeedContract = web3.eth.contract(abi);
        var priceFeed;
        var symbols = ['USD_ETH', 'BTC_ETH', 'USDT_BTC', 'EURUSD', 'GBPUSD', 'USDJPY', 'XAUUSD', 'XAGUSD', 'SP500', 'NASDAQ', 'AAPL', 'GOOG', 'MSFT', 'GM', 'WMT', 'F', 'T'];
    </script>
</head>
<body>
    <h1>Randomized Price Feed</h1>

    <div style="background-color: azure " id="result"></div>

    <input type="text" id="address" size="40" />
    <button onclick="createFeed()">Create</button>
    <button onclick="loadFeed()">Load</button>
    <button onclick="refreshFeed()">Refresh</button>

    <p>Prices</p>
    <table id="prices"></table>
</body>
</html>